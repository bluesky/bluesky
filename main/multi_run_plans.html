<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Run Plans &mdash; bluesky 1.13.0a4.dev38+gff57ab4d documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=af119964"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debugging and Logging" href="debugging.html" />
    <link rel="prev" title="Asynchronous Acquisition" href="async.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            bluesky
          </a>
              <div class="version">
                1.13.0a4.dev38+gff57ab4d
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="plans.html">Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Recording Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks.html">Live Visualization and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="state-machine.html">Interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation and Error Checking</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress-bar.html">Progress Bar</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_descriptors.html">Event Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">Asynchronous Acquisition</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multi-Run Plans</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#definition-of-a-run">Definition of a ‘Run’</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bluesky-features-for-support-of-multi-run-plans">Bluesky Features for Support of Multi-run Plans</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plans-with-sequential-runs">Plans with Sequential Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plans-with-nested-runs">Plans with Nested Runs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging and Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine_api.html">RunEngine API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="magics.html">IPython ‘Magics’ [Experimental]</a></li>
<li class="toctree-l1"><a class="reference internal" href="from-pyepics-to-bluesky.html">Translating Direct PyEpics Code to Bluesky Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison-with-spec.html">Comparison with SPEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware-interfaces.html">Hardware Interface Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">How Bluesky Interfaces with Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="msg.html">Message Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine.html">The RunEngine run loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_changes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Collection</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">ophyd</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Access and Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">databroker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/amostra">amostra</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/datamuxer">datamuxer</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/suitcase">suitcase</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GitHub Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NSLS-II/">NSLS-II Repositories</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NSLS-II/Bug-Reports/issues">Bug Reports</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bluesky</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Multi-Run Plans</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/multi_run_plans.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="multi-run-plans">
<h1>Multi-Run Plans<a class="headerlink" href="#multi-run-plans" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This section is a brief tutorial on multi-run plans (introduced in Bluesky v1.6.0).
A traditional single-run plan contains a set of instructions for performing only one run,
which is assigned a scan ID and a UID. When a multi-run plan is executed by the Run Engine, multiple
runs can be performed as part of a single plan. Data from each run can be independently
displayed and saved to the database via Databroker. Prior versions of Bluesky supported
only sequential execution of multiple runs within a plan: building larger plans by creating
a sequence of smaller plans and preassembled plans shipped with Bluesky is a standard
practice. In Bluesky v1.6.0 a number of features were introduced to allow plans
with nested runs. Two runs are considered nested if one ‘outer’ run is interrupted, another
‘inner’ run is executed, and then the first run is resumed and completed. The number of levels
of nesting is not limited by Bluesky. Interruptions can be initiated by the plan itself
(simply by opening another run before closing currently executed run) or externally (e.g.
by triggering a suspender and causing execution of pre- or post-plan). This tutorial includes
a brief explanation of the new Bluesky features for supporting multi-run plans and several
examples that demonstrate the implementation of plans that contain sequential, nested and recursive
runs.</p>
</section>
<section id="definition-of-a-run">
<h2>Definition of a ‘Run’<a class="headerlink" href="#definition-of-a-run" title="Link to this heading">¶</a></h2>
<p>From the point of view of Bluesky, a run is a sequence of instructions (messages) for controlling
the instrumental equipment that starts with <cite>open_run</cite> and ends with <cite>close_run</cite> message.
We may also apply the term ‘run’ to a block of code which generates such a sequence of messages.
Data from each run is bundled together via an assigned distinct Scan ID and UID. The set of documents
is also generated for each run, including mandatory ‘start’ and ‘stop’ documents. The documents
can be processed by callbacks (such as BestEffortCallback) and saved to the database via Databroker.</p>
<p>In the plan, the run may be defined by explicitely enclosing the code in <cite>bps.open_run()</cite> and
<cite>bps.close_run()</cite> stubs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using &#39;bps.open_run()&#39; and &#39;bps.close_run()&#39; stubs to define a run</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># &#39;md&#39; - metadata to be added to the &#39;start&#39; document</span>
    <span class="o">...</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="o">...</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>or using <cite>&#64;bpp.run_decorator</cite>, which inserts <cite>open_run</cite> and <cite>close_run</cite> control messages
before and after the sequnce generated by the enclosed code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using &#39;bpp.run_decorator&#39; to define a run</span>

<span class="kn">import</span> <span class="nn">bluesky.preprocessors</span> <span class="k">as</span> <span class="nn">bpp</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># &#39;md&#39; - metadata to be added to the &#39;start&#39; document</span>
<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="o">...</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>The rules for basic Bluesky plans require that the currently running scan is closed before
the next scan is opened, therefore the following code works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code works, since the first run is closed before the second one is opened</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>  <span class="c1"># Closing the first run (scan)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># Opening the second run (scan)</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>but the following code fails:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code fails, since the second run is opened before the first run is closed</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># Opening the first run</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># Opening the second run before the first one is closed</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>Note, that the preassembled plans, such as <cite>bluesky.plans.count</cite> or <cite>bluesky.plans.list_scan</cite>,
are complete single-run plans, enclosed in <cite>open_run</cite> and <cite>close_run</cite> messages, therefore
the following code fails as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code fails while attempting to start a preassembled plan from an open run</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># Starting the first run</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">scan</span> <span class="o">&gt;</span>
    <span class="k">yield from</span> <span class="n">bpp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">&lt;</span><span class="n">some</span> <span class="n">arguments</span><span class="o">&gt;</span><span class="p">)</span>  <span class="c1"># Attempting to run a preassembled plan from an open run</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>An example of the situation when a preassembled plan is called from another open run is
when a preassembled plan is included in a suspender pre- or post-plan. When the suspender is
triggered, the current run is interrupted (not closed) and the pre- or post-plan attempts to open
another run (the mechanism is the same as in the case of nested runs, see below). As a result,
Run Engine fails for the same reason as in the two previous code examples. The new multi-run plan
Bluesky features allow to implement nested plans, as well as include full-featured scans
in pre- and post-plans.</p>
</section>
<section id="bluesky-features-for-support-of-multi-run-plans">
<h2>Bluesky Features for Support of Multi-run Plans<a class="headerlink" href="#bluesky-features-for-support-of-multi-run-plans" title="Link to this heading">¶</a></h2>
<p>In order to handle simultaneously open runs within a plan, Run Engine is looking at the run key attribute
of each control message to decide which scan is currently being executed. The default value for the run key
is <cite>None</cite>, but it could be manually set in the plan for any block of code which define the run. A run key
value may be of any type, but it is <strong>strongly</strong> recommended that manually assigned run keys are
human-readable informative strings.</p>
<p>The new ‘inner’ run can be opened from within the ‘outer’ run only if the run keys of the ‘inner’ and
‘outer’ scans are different. Otherwise the plan exectuion fails.</p>
<p>The run key is used by Run Engine</p>
<ul class="simple">
<li><p>to maintain the state of each run independently from other open runs;</p></li>
<li><p>to include run metadata, such as scan ID and UID, into the emitted documents. (Metadata is then used
to route the documents to the appropriate callbacks. If documents are saved using Databroker, the metadata
allows to associate documents with runs and retrieve run data from the database.)</p></li>
</ul>
<p>Run key is assigned to a block of code using <cite>bpp.set_run_key_wrapper</cite> or <cite>&#64;bpp.set_run_key_decorator</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky.preprocessors</span> <span class="k">as</span> <span class="nn">bpp</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="c1"># Using decorator</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="s2">&quot;run_key_example_1&quot;</span><span class="p">)</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
<span class="k">def</span> <span class="nf">sample_plan</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="o">&lt;</span> <span class="n">code</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">run</span> <span class="o">&gt;</span>
    <span class="o">...</span>

<span class="n">RE</span><span class="p">(</span><span class="n">sample_plan</span><span class="p">())</span>

<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">hw</span>
<span class="n">det</span><span class="p">,</span> <span class="n">motor</span> <span class="o">=</span> <span class="n">hw</span><span class="p">()</span><span class="o">.</span><span class="n">det</span><span class="p">,</span> <span class="n">hw</span><span class="p">()</span><span class="o">.</span><span class="n">motor</span>

<span class="c1"># Using wrapper</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">s_wrapped</span> <span class="o">=</span> <span class="n">bpp</span><span class="o">.</span><span class="n">set_run_key_wrapper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;run_key_example_2&quot;</span><span class="p">)</span>
<span class="n">RE</span><span class="p">(</span><span class="n">s_wrapped</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of <cite>&#64;bpp.set_run_key_decorator</cite> and <cite>bpp.set_run_key_wrapper</cite> is
replacing the default value <cite>None</cite> of the attribute <cite>run</cite> in each message generated within
the enclosed block with the user-defined run key.</p>
<p>The <cite>&#64;bpp.set_run_key_decorator</cite> and <cite>bpp.set_run_key_wrapper</cite> are primarily intended
to be applied to a function that contains a run implementation, but may be also used
with any block of plan code. For example, one may write a plan that simultaneously
opens multiple runs and executes them in parallel by generating groups of messages
with run ids of the open scans. This is currently not recommended and should be attempted
only at the developer’s own risk.</p>
</section>
<section id="plans-with-sequential-runs">
<h2>Plans with Sequential Runs<a class="headerlink" href="#plans-with-sequential-runs" title="Link to this heading">¶</a></h2>
<p>Sequential calling of multiple runs is supported by older versions of Bluesky. There is no need
to use multi-run plan features if runs are not overlapping (the next run is opened only after
the previous run is closed), but run keys still can be assigned to all or some runs if needed.</p>
<p>In the following example, two preassembled plans are called in sequence. Run Engine is subscribed to
a single instance of BestEffortCallback, which is set up to display data specific for each run
when the run opened.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: consecutive execution of single-run plans</span>

<span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">hw</span>

<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">rel_scan</span><span class="p">,</span> <span class="n">scan</span>

<span class="n">hw</span> <span class="o">=</span> <span class="n">hw</span><span class="p">()</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>

<span class="n">bec</span> <span class="o">=</span> <span class="n">BestEffortCallback</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">bec</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plan_sequential_runs</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="c1"># Single-run plans may be called consecutively. No special handling is required</span>
    <span class="c1">#   as long as the previous scan is closed before the next one is opened</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">],</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">rel_scan</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">],</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">RE</span><span class="p">(</span><span class="n">plan_sequential_runs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>


<span class="go">Transient Scan ID: 1     Time: 2024-04-16 15:10:50</span>
<span class="go">Persistent Unique Scan ID: &#39;f1f53dca-cfbe-4242-b93a-de498d1e2cc9&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det1 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|         1 | 15:10:50.5 |     -1.000 |      0.677 |</span>
<span class="go">|         2 | 15:10:50.5 |     -0.778 |      1.491 |</span>
<span class="go">|         3 | 15:10:50.6 |     -0.556 |      2.697 |</span>
<span class="go">|         4 | 15:10:50.6 |     -0.333 |      4.004 |</span>
<span class="go">|         5 | 15:10:50.7 |     -0.111 |      4.878 |</span>
<span class="go">|         6 | 15:10:50.7 |      0.111 |      4.878 |</span>
<span class="go">|         7 | 15:10:50.8 |      0.333 |      4.004 |</span>
<span class="go">|         8 | 15:10:50.8 |      0.556 |      2.697 |</span>
<span class="go">|         9 | 15:10:50.9 |      0.778 |      1.491 |</span>
<span class="go">|        10 | 15:10:50.9 |      1.000 |      0.677 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator scan [&#39;f1f53dca&#39;] (scan num: 1)</span>





<span class="go">Transient Scan ID: 2     Time: 2024-04-16 15:10:51</span>
<span class="go">Persistent Unique Scan ID: &#39;a955f392-f8dd-4293-abf1-bc29fd9bb32f&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det2 |       det1 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|         1 | 15:10:51.1 |      0.000 |      1.765 |      5.000 |</span>
<span class="go">|         2 | 15:10:51.6 |      0.222 |      1.765 |      4.530 |</span>
<span class="go">|         3 | 15:10:51.8 |      0.444 |      1.765 |      3.368 |</span>
<span class="go">|         4 | 15:10:52.0 |      0.667 |      1.765 |      2.056 |</span>
<span class="go">|         5 | 15:10:52.2 |      0.889 |      1.765 |      1.030 |</span>
<span class="go">|         6 | 15:10:52.4 |      1.111 |      1.765 |      0.423 |</span>
<span class="go">|         7 | 15:10:52.6 |      1.333 |      1.765 |      0.143 |</span>
<span class="go">|         8 | 15:10:52.9 |      1.556 |      1.765 |      0.040 |</span>
<span class="go">|         9 | 15:10:53.1 |      1.778 |      1.765 |      0.009 |</span>
<span class="go">|        10 | 15:10:53.3 |      2.000 |      1.765 |      0.002 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">generator rel_scan [&#39;a955f392&#39;] (scan num: 2)</span>



<span class="gh">Out[1]: </span>
<span class="go">(&#39;f1f53dca-cfbe-4242-b93a-de498d1e2cc9&#39;,</span>
<span class="go"> &#39;a955f392-f8dd-4293-abf1-bc29fd9bb32f&#39;)</span>
</pre></div>
</div>
</section>
<section id="plans-with-nested-runs">
<h2>Plans with Nested Runs<a class="headerlink" href="#plans-with-nested-runs" title="Link to this heading">¶</a></h2>
<p>The following example illustrates the use of <cite>&#64;bpp.set_run_key_decorator</cite> to implement two nested runs:
the ‘outer’ run interrupts measurements, calls the ‘inner’ run and then completes the measurements.
The ‘outer’ and ‘inner’ runs are assigned different run ids (‘run_1’ and ‘run_2’). Note that
the <cite>&#64;bpp.set_run_key_decorator</cite> for the ‘outer’ run does not overwrite the run id of the ‘inner’ scan,
despite the fact that it is generated inside the enclosed code, since the decorator is designed to replace
the run id attribute of the message only if it has the default value of <cite>None</cite>, i.e. the run id of
a message can be replaced by the decorator only the first time it is processed by the decorator.</p>
<p>If multiple runs are to be opened simultaneously, each run needs to be subscribed to its own instance
of callback. Standard RunEngine subscription mechanism does not provide this capability. Instead,
subscription should be performed via <cite>RunRouter</cite>. The code in the following example demonstrates how
to use <cite>BestEffortCallback</cite> to monitor data from multiple nested runs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: nested runs</span>

<span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="kn">from</span> <span class="nn">event_model</span> <span class="kn">import</span> <span class="n">RunRouter</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">hw</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">import</span> <span class="nn">bluesky.preprocessors</span> <span class="k">as</span> <span class="nn">bpp</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>

<span class="n">hw</span> <span class="o">=</span> <span class="n">hw</span><span class="p">()</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="c1"># Documents from each run is routed to an independent</span>
    <span class="c1">#   instance of BestEffortCallback</span>
    <span class="n">bec</span> <span class="o">=</span> <span class="n">BestEffortCallback</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">bec</span><span class="p">],</span> <span class="p">[]</span>


<span class="n">rr</span> <span class="o">=</span> <span class="n">RunRouter</span><span class="p">([</span><span class="n">factory</span><span class="p">])</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>


<span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="s2">&quot;run_2&quot;</span><span class="p">)</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
<span class="k">def</span> <span class="nf">sim_plan_inner</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">declare_stream</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">])</span>


<span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="s2">&quot;run_1&quot;</span><span class="p">)</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
<span class="k">def</span> <span class="nf">sim_plan_outer</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">declare_stream</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det</span><span class="p">])</span>

    <span class="k">yield from</span> <span class="n">sim_plan_inner</span><span class="p">(</span><span class="n">npts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">npts</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det</span><span class="p">])</span>
</pre></div>
</div>
<p>The output of the plan contains data from two runs with each run assigned its own ID and UID. The tables
for the runs are printed by two separate instances of <cite>BestEffortCallback</cite>. The data from two tables
is printed in the order of acquisition: the table for the ‘inner’ run is printed in the gap of
the table for the ‘outer’ run.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">RE</span><span class="p">(</span><span class="n">sim_plan_outer</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>


<span class="go">Transient Scan ID: 1     Time: 2024-04-16 15:10:53</span>
<span class="go">Persistent Unique Scan ID: &#39;5a59c9bd-df6e-4b42-8f4c-14fd7ea09e3e&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |      motor |        det |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>


<span class="go">Transient Scan ID: 2     Time: 2024-04-16 15:10:54</span>
<span class="go">Persistent Unique Scan ID: &#39;c978c222-d18a-4d32-8b5f-682c9afc76c8&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det2 |     motor2 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">generator sim_plan_outer [&#39;c978c222&#39;] (scan num: 2)</span>



<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator sim_plan_outer [&#39;5a59c9bd&#39;] (scan num: 1)</span>



<span class="gh">Out[2]: </span>
<span class="go">(&#39;5a59c9bd-df6e-4b42-8f4c-14fd7ea09e3e&#39;,</span>
<span class="go"> &#39;c978c222-d18a-4d32-8b5f-682c9afc76c8&#39;)</span>
</pre></div>
</div>
<p>The wrapper <cite>bpp.set_run_key_wrapper</cite> can be used instead of the decorator. For example
the run <cite>sim_plan_inner</cite> from the previous example can be rewritten as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sim_plan_inner</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">])</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">bpp</span><span class="o">.</span><span class="n">run_wrapper</span><span class="p">(</span><span class="n">f</span><span class="p">(),</span> <span class="n">md</span><span class="o">=</span><span class="p">{})</span>
    <span class="k">return</span> <span class="n">bpp</span><span class="o">.</span><span class="n">set_run_key_wrapper</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;run_2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Subscription to callbacks via RunRouter provides flexibility to subscribe each run
to its own set of callbacks. In the following example <cite>run_key</cite> is added to the start
document metadata and used to distinguish between two runs in the function factory that
performs callback subscriptions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: subscribing runs to individual sets of callbacks</span>

<span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="kn">from</span> <span class="nn">event_model</span> <span class="kn">import</span> <span class="n">RunRouter</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">hw</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">import</span> <span class="nn">bluesky.preprocessors</span> <span class="k">as</span> <span class="nn">bpp</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LivePlot</span><span class="p">,</span> <span class="n">LiveTable</span>

<span class="n">hw</span> <span class="o">=</span> <span class="n">hw</span><span class="p">()</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="c1"># Runs may be subscribed to different sets of callbacks. Metadata from start</span>
    <span class="c1">#   document may be used to identify, which run is currently being started.</span>
    <span class="c1">#   In this example, the run key is explicitely added to the start document</span>
    <span class="c1">#   and used to identify runs, but other data can be similarly used.</span>
    <span class="n">cb_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;run_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;run_1&quot;</span><span class="p">:</span>
        <span class="n">cb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LiveTable</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">]))</span>
        <span class="n">cb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LivePlot</span><span class="p">(</span><span class="s2">&quot;det1&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;motor1&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;run_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;run_2&quot;</span><span class="p">:</span>
        <span class="n">cb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LiveTable</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">cb_list</span><span class="p">,</span> <span class="p">[]</span>


<span class="n">rr</span> <span class="o">=</span> <span class="n">RunRouter</span><span class="p">([</span><span class="n">factory</span><span class="p">])</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>


<span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="s2">&quot;run_2&quot;</span><span class="p">)</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;run_key&quot;</span><span class="p">:</span> <span class="s2">&quot;run_2&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">sim_plan_inner</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">declare_stream</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">motor2</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det2</span><span class="p">])</span>


<span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="s2">&quot;run_1&quot;</span><span class="p">)</span>
<span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;run_key&quot;</span><span class="p">:</span> <span class="s2">&quot;run_1&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">sim_plan_outer</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">declare_stream</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>

    <span class="k">yield from</span> <span class="n">sim_plan_inner</span><span class="p">(</span><span class="n">npts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">npts</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">RE</span><span class="p">(</span><span class="n">sim_plan_outer</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>


<span class="go">+-----------+------------+------------+-----------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 | motor1_setpoint |       det1 |</span>
<span class="go">+-----------+------------+------------+-----------------+------------+</span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>


<span class="go">+-----------+------------+------------+-----------------+------------+-----------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 | motor1_setpoint |     motor2 | motor2_setpoint |       det2 |</span>
<span class="go">+-----------+------------+------------+-----------------+------------+-----------------+------------+</span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go">+-----------+------------+------------+-----------------+------------+-----------------+------------+</span>
<span class="go">generator sim_plan_outer [&#39;d86cc206&#39;] (scan num: 2)</span>


<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go">+-----------+------------+------------+-----------------+------------+</span>
<span class="go">generator sim_plan_outer [&#39;b7f70305&#39;] (scan num: 1)</span>


<span class="gh">Out[3]: </span>
<span class="go">(&#39;b7f70305-f39e-436f-ab43-46b5780363a9&#39;,</span>
<span class="go"> &#39;d86cc206-b7b2-4deb-9101-f301e45fd5ee&#39;)</span>
</pre></div>
</div>
<p>In some cases it may be necessary to implement a run that could be interrupted
and a new instance of the same run started. For example, the suspender pre- or post-plan
may contain a run, which takes substantial time to execute. Such run may be interrupted
if the suspender is repeatedly triggered. This will cause another instance of the pre-
or post-plan to be started while the first one is still in the open state. This process
is similar to recursive calling of the run (run which includes instructions to call
itself). Recursive calls are possible if unique run key is assigned to a run each
time it is started.</p>
<p>The following example illustrates dynamic generation of run keys. The plan may have no practical purpose
besides demonstration of the principle. The plan is calling itself recursively multiple times until
the global counter <cite>n_calls</cite> reaches the maximum value of <cite>n_calls_max</cite>. The unique run key is generated
before at each call.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: recursive runs</span>

<span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="kn">from</span> <span class="nn">event_model</span> <span class="kn">import</span> <span class="n">RunRouter</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">hw</span>

<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">import</span> <span class="nn">bluesky.preprocessors</span> <span class="k">as</span> <span class="nn">bpp</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>

<span class="n">hw</span> <span class="o">=</span> <span class="n">hw</span><span class="p">()</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="c1"># Each run is subscribed to independent instance of BEC</span>
    <span class="n">bec</span> <span class="o">=</span> <span class="n">BestEffortCallback</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">bec</span><span class="p">],</span> <span class="p">[]</span>


<span class="n">rr</span> <span class="o">=</span> <span class="n">RunRouter</span><span class="p">([</span><span class="n">factory</span><span class="p">])</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>

<span class="c1"># Call counter and the maximum number calls</span>
<span class="n">n_calls</span><span class="p">,</span> <span class="n">n_calls_max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">sim_plan_recursive</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">n_calls</span><span class="p">,</span> <span class="n">n_calls_max</span>

    <span class="n">n_calls</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Increment counter</span>
    <span class="k">if</span> <span class="n">n_calls</span> <span class="o">&lt;=</span> <span class="n">n_calls_max</span><span class="p">:</span>
        <span class="c1"># Generate unique key for each run. The key generation algorithm</span>
        <span class="c1">#   must only guarantee that execution of the runs that are assigned</span>
        <span class="c1">#   the same key will never overlap in time.</span>
        <span class="n">run_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run_key_</span><span class="si">{</span><span class="n">n_calls</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nd">@bpp</span><span class="o">.</span><span class="n">set_run_key_decorator</span><span class="p">(</span><span class="n">run_key</span><span class="p">)</span>
        <span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">def</span> <span class="nf">plan</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">declare_stream</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>

            <span class="c1"># Different parameter values may be passed to the recursively called plans</span>
            <span class="k">yield from</span> <span class="n">sim_plan_recursive</span><span class="p">(</span><span class="n">npts</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">npts</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>

        <span class="k">yield from</span> <span class="n">plan</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">RE</span><span class="p">(</span><span class="n">sim_plan_recursive</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>


<span class="go">Transient Scan ID: 1     Time: 2024-04-16 15:11:02</span>
<span class="go">Persistent Unique Scan ID: &#39;caad9cf7-d24b-400d-94d4-09f97d185931&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det1 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>


<span class="go">Transient Scan ID: 2     Time: 2024-04-16 15:11:03</span>
<span class="go">Persistent Unique Scan ID: &#39;4b6b7848-45ca-4e61-8f9d-4484438a156a&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det1 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|         1 | 15:11:03.1 |      0.000 |      5.000 |</span>
<span class="go">|         2 | 15:11:03.3 |      0.200 |      4.616 |</span>
<span class="go">|         3 | 15:11:03.5 |      0.400 |      3.631 |</span>


<span class="go">Transient Scan ID: 3     Time: 2024-04-16 15:11:03</span>
<span class="go">Persistent Unique Scan ID: &#39;5e2d166c-b928-4029-a7f8-e9f2ef1404e5&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |     motor1 |       det1 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|         1 | 15:11:03.7 |      0.000 |      5.000 |</span>
<span class="go">|         2 | 15:11:03.9 |      0.200 |      4.616 |</span>
<span class="go">|         3 | 15:11:04.2 |      0.400 |      3.631 |</span>
<span class="go">|         4 | 15:11:04.4 |      0.600 |      2.434 |</span>
<span class="go">|         5 | 15:11:04.7 |      0.800 |      1.390 |</span>
<span class="go">|         6 | 15:11:04.9 |      1.000 |      0.677 |</span>
<span class="go">|         7 | 15:11:05.1 |      1.200 |      0.281 |</span>
<span class="go">|         8 | 15:11:05.3 |      1.400 |      0.099 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator sim_plan_recursive [&#39;5e2d166c&#39;] (scan num: 3)</span>



<span class="go">|         4 | 15:11:05.9 |      0.600 |      2.434 |</span>
<span class="go">|         5 | 15:11:06.1 |      0.800 |      1.390 |</span>
<span class="go">|         6 | 15:11:06.3 |      1.000 |      0.677 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator sim_plan_recursive [&#39;4b6b7848&#39;] (scan num: 2)</span>



<span class="go"> failed to format row </span>
<span class="go"> failed to format row </span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator sim_plan_recursive [&#39;caad9cf7&#39;] (scan num: 1)</span>



<span class="gh">Out[4]: </span>
<span class="go">(&#39;caad9cf7-d24b-400d-94d4-09f97d185931&#39;,</span>
<span class="go"> &#39;4b6b7848-45ca-4e61-8f9d-4484438a156a&#39;,</span>
<span class="go"> &#39;5e2d166c-b928-4029-a7f8-e9f2ef1404e5&#39;)</span>
</pre></div>
</div>
<p>The identical result can be achieved by using <cite>bpp.set_run_key_wrapper()</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Call counter and the maximum number calls</span>
<span class="n">n_calls</span><span class="p">,</span> <span class="n">n_calls_max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">sim_plan_recursive</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">n_calls</span><span class="p">,</span> <span class="n">n_calls_max</span>

    <span class="n">n_calls</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Increment counter</span>
    <span class="k">if</span> <span class="n">n_calls</span> <span class="o">&lt;=</span> <span class="n">n_calls_max</span><span class="p">:</span>
        <span class="c1"># Generate unique key for each run. The key generation algorithm</span>
        <span class="c1">#   must only guarantee that execution of the runs that are assigned</span>
        <span class="c1">#   the same key will never overlap in time.</span>
        <span class="n">run_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run_key_</span><span class="si">{</span><span class="n">n_calls</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nd">@bpp</span><span class="o">.</span><span class="n">run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">def</span> <span class="nf">plan</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>

            <span class="c1"># Different parameter values may be passed to the recursively called plans</span>
            <span class="k">yield from</span> <span class="n">sim_plan_recursive</span><span class="p">(</span><span class="n">npts</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">npts</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mov</span><span class="p">(</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">hw</span><span class="o">.</span><span class="n">motor1</span><span class="p">,</span> <span class="n">hw</span><span class="o">.</span><span class="n">det1</span><span class="p">])</span>

        <span class="k">yield from</span> <span class="n">bpp</span><span class="o">.</span><span class="n">set_run_key_wrapper</span><span class="p">(</span><span class="n">plan</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span> <span class="n">run_key</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="async.html" class="btn btn-neutral float-left" title="Asynchronous Acquisition" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging and Logging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, Brookhaven National Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>