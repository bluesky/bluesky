
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Live Visualization and Processing &#8212; bluesky 1.14.dev25+gaa6d13ed documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=0565605c"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'callbacks';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://blueskyproject.io/bluesky/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.14.dev25+gaa6d13ed';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="bluesky.callbacks.best_effort.BestEffortCallback" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.html" />
    <link rel="prev" title="Recording Metadata" href="metadata.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.14.dev25+gaa6d13ed" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/bluesky-logo-dark.svg" class="logo__image only-light" alt=""/>
    <img src="_static/bluesky-logo-dark.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">bluesky</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="userindex.html">
    User Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="devindex.html">
    Developer Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/bluesky">
    bluesky
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/ophyd">
    ophyd
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/databroker">
    databroker
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://nsls-ii.github.io/amostra">
    amostra
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://nsls-ii.github.io/datamuxer">
    datamuxer
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://blueskyproject.io/suitcase">
    suitcase
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/NSLS-II/">
    NSLS-II Repositories
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/NSLS-II/Bug-Reports/issues">
    Bug Reports
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/bluesky/bluesky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/bluesky" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="userindex.html">
    User Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="devindex.html">
    Developer Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/bluesky">
    bluesky
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/ophyd">
    ophyd
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/databroker">
    databroker
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://nsls-ii.github.io/amostra">
    amostra
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://nsls-ii.github.io/datamuxer">
    datamuxer
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/suitcase">
    suitcase
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NSLS-II/">
    NSLS-II Repositories
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NSLS-II/Bug-Reports/issues">
    Bug Reports
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/bluesky/bluesky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/bluesky" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="plans.html">Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Recording Metadata</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Live Visualization and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="state-machine.html">Interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation and Error Checking</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress-bar.html">Progress Bar</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_descriptors.html">Event Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">Asynchronous Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_run_plans.html">Multi-Run Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging and Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine_api.html">RunEngine API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="magics.html">IPython ‘Magics’ [Experimental]</a></li>
<li class="toctree-l1"><a class="reference internal" href="otel-tracing.html">Tracing with Opentelemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="from-pyepics-to-bluesky.html">Translating Direct PyEpics Code to Bluesky Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison-with-spec.html">Comparison with SPEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware-interfaces.html">Hardware Interface Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="userindex.html" class="nav-link">User Documentation</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Live Visualization and Processing</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="live-visualization-and-processing">
<h1>Live Visualization and Processing<a class="headerlink" href="#live-visualization-and-processing" title="Link to this heading">#</a></h1>
<section id="overview-of-callbacks">
<span id="callbacks"></span><h2>Overview of Callbacks<a class="headerlink" href="#overview-of-callbacks" title="Link to this heading">#</a></h2>
<p>As the RunEngine executes a plan, it organizes metadata and data into
<em>Documents,</em> Python dictionaries organized in a
<a class="reference internal" href="documents.html"><span class="doc">specified but flexible</span></a> way. Each time a new Document is
created, the RunEngine passes it to a list of functions. These functions can do
anything: store the data to disk, print a line of text to the screen, add a
point to a plot, or even transfer the data to a cluster for immediate
processing. These functions are called “callbacks.”</p>
<p>We “subscribe” callbacks to the live stream of Documents coming from the
RunEngine. You can think of a callback as a self-addressed stamped envelope: it
tells the RunEngine, “When you create a Document, send it to this function for
processing.”</p>
<p>Callback functions are run in a blocking fashion: data acquisition cannot
continue until they return. For light tasks like simple plotting or critical
tasks like sending the data to a long-term storage medium, this behavior is
desirable. It is easy to debug and it guarantees that critical errors will be
noticed immediately. But heavy computational tasks — anything that takes more
than about 0.2 seconds to finish — should be executed in a separate process
or server so that they do not hold up data acquisition. Bluesky provides nice
tooling for this use case — see <a class="reference internal" href="#zmq-callback"><span class="std std-ref">Subscriptions in Separate Processes or Host with 0MQ</span></a>.</p>
</section>
<section id="simplest-working-example">
<h2>Simplest Working Example<a class="headerlink" href="#simplest-working-example" title="Link to this heading">#</a></h2>
<p>This example passes every Document to the <code class="docutils literal notranslate"><span class="pre">print</span></code> function, printing
each Document as it is generated during data collection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span>

<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">]),</span> <span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">print</span></code> function is a blunt instrument; it dumps too much information to
the screen.  See <a class="reference internal" href="#livetable"><span class="std std-ref">LiveTable</span></a> below for a more refined option.</p>
</section>
<section id="ways-to-invoke-callbacks">
<h2>Ways to Invoke Callbacks<a class="headerlink" href="#ways-to-invoke-callbacks" title="Link to this heading">#</a></h2>
<section id="interactively">
<h3>Interactively<a class="headerlink" href="#interactively" title="Link to this heading">#</a></h3>
<p>As in the simple example above, pass a second argument to the RunEngine.
For some callback function <code class="docutils literal notranslate"><span class="pre">cb</span></code>, the usage is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">cb</span><span class="p">))</span>
</pre></div>
</div>
<p>A working example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveTable</span>
<span class="n">dets</span> <span class="o">=</span> <span class="p">[</span><span class="n">det</span><span class="p">]</span>
<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">LiveTable</span><span class="p">([</span><span class="s2">&quot;det&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>A <em>list</em> of callbacks — <code class="docutils literal notranslate"><span class="pre">[cb1,</span> <span class="pre">cb2]</span></code> — is also accepted; see
<a class="reference internal" href="#filtering"><span class="std std-ref">Filtering by Document Type</span></a>, below, for additional options.</p>
</section>
<section id="persistently">
<h3>Persistently<a class="headerlink" href="#persistently" title="Link to this heading">#</a></h3>
<p>The RunEngine keeps a list of callbacks to apply to <em>every</em> plan it executes.
For example, the callback that saves the data to a database is typically
invoked this way. For some callback function <code class="docutils literal notranslate"><span class="pre">cb</span></code>, the usage is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
<p>This step is usually performed in a startup file (i.e., IPython profile).</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">RunEngine.</span></span><span class="sig-name descname"><span class="pre">subscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/run_engine.html#RunEngine.subscribe"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Register a callback function to consume documents.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.10.0: </span>The order of the arguments was swapped and the <code class="docutils literal notranslate"><span class="pre">name</span></code>
argument has been given a default value, <code class="docutils literal notranslate"><span class="pre">'all'</span></code>. Because the
meaning of the arguments is unambiguous (they must be a callable
and a string, respectively) the old order will be supported
indefinitely, with a warning.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>func: callable</strong></dt><dd><p>expecting signature like <code class="docutils literal notranslate"><span class="pre">f(name,</span> <span class="pre">document)</span></code>
where name is a string and document is a dict</p>
</dd>
<dt><strong>name</strong><span class="classifier">{‘all’, ‘start’, ‘descriptor’, ‘event’, ‘stop’}, optional</span></dt><dd><p>the type of document this function should receive (‘all’ by
default)</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>token</strong><span class="classifier">int</span></dt><dd><p>an integer ID that can be used to unsubscribe</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="generated/bluesky.run_engine.RunEngine.unsubscribe.html#bluesky.run_engine.RunEngine.unsubscribe" title="bluesky.run_engine.RunEngine.unsubscribe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RunEngine.unsubscribe()</span></code></a></dt><dd></dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">RunEngine.</span></span><span class="sig-name descname"><span class="pre">unsubscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/run_engine.html#RunEngine.unsubscribe"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Unregister a callback function its integer ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>token</strong><span class="classifier">int</span></dt><dd><p>the integer ID issued by <a class="reference internal" href="generated/bluesky.run_engine.RunEngine.subscribe.html#bluesky.run_engine.RunEngine.subscribe" title="bluesky.run_engine.RunEngine.subscribe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RunEngine.subscribe()</span></code></a></p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="generated/bluesky.run_engine.RunEngine.subscribe.html#bluesky.run_engine.RunEngine.subscribe" title="bluesky.run_engine.RunEngine.subscribe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RunEngine.subscribe()</span></code></a></dt><dd></dd>
</dl>
</div>
</dd></dl>

</section>
<section id="through-a-plan">
<span id="subs-decorator"></span><h3>Through a plan<a class="headerlink" href="#through-a-plan" title="Link to this heading">#</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">subs_decorator</span></code> <a class="reference internal" href="plans.html#preprocessors"><span class="std std-ref">plan preprocessor</span></a> to attach
callbacks to a plan so that they are subscribed every time it is run.</p>
<p>In this example, we define a new plan, <code class="docutils literal notranslate"><span class="pre">plan2</span></code>, that adds some callback
<code class="docutils literal notranslate"><span class="pre">cb</span></code> to some existing plan, <code class="docutils literal notranslate"><span class="pre">plan1</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.preprocessors</span> <span class="kn">import</span> <span class="n">subs_decorator</span>

<span class="nd">@subs_decorator</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plan2</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">plan1</span><span class="p">()</span>
</pre></div>
</div>
<p>or, equivalently,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plan2</span> <span class="o">=</span> <span class="n">subs_decorator</span><span class="p">(</span><span class="n">cb</span><span class="p">)(</span><span class="n">plan1</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, to define a variant of <code class="docutils literal notranslate"><span class="pre">scan</span></code> that includes a table by default:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">bluesky.preprocessors</span> <span class="kn">import</span> <span class="n">subs_decorator</span>

<span class="k">def</span> <span class="nf">my_scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">per_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;This plan takes the same arguments as `scan`.&quot;</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">LiveTable</span><span class="p">([</span><span class="n">motor</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">det</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detectors</span><span class="p">])</span>

    <span class="nd">@subs_decorator</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">yield from</span> <span class="n">scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span>
                        <span class="n">per_step</span><span class="o">=</span><span class="n">per_step</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>

    <span class="k">yield from</span> <span class="n">inner</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="callbacks-for-visualization-fitting">
<h2>Callbacks for Visualization &amp; Fitting<a class="headerlink" href="#callbacks-for-visualization-fitting" title="Link to this heading">#</a></h2>
<section id="livetable">
<span id="id1"></span><h3>LiveTable<a class="headerlink" href="#livetable" title="Link to this heading">#</a></h3>
<p>As each data point is collected (i.e., as each Event Document is generated) a
row is added to the table. Demo:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span><span class="p">,</span> <span class="n">det</span>

<span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveTable</span>

<span class="gp">In [4]: </span><span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">LiveTable</span><span class="p">([</span><span class="s2">&quot;motor&quot;</span><span class="p">,</span> <span class="s2">&quot;det&quot;</span><span class="p">]))</span>


<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |      motor |        det |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|         1 | 14:03:25.3 |      1.000 |      0.607 |</span>
<span class="go">|         2 | 14:03:25.3 |      2.000 |      0.135 |</span>
<span class="go">|         3 | 14:03:25.3 |      3.000 |      0.011 |</span>
<span class="go">|         4 | 14:03:25.3 |      4.000 |      0.000 |</span>
<span class="go">|         5 | 14:03:25.3 |      5.000 |      0.000 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator scan [&#39;a1fd45cf&#39;] (scan num: 1)</span>


<span class="gh">Out[4]: </span><span class="go">(&#39;a1fd45cf-87f9-4b60-be78-7969ec79c66b&#39;,)</span>
</pre></div>
</div>
<p>Pass an empty list of columns to show simply ‘time’ and ‘seq_num’ (sequence
number).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LiveTable</span><span class="p">([])</span>
</pre></div>
</div>
<p>For devices which are implemented using synchronous functions, for example
<code class="docutils literal notranslate"><span class="pre">ophyd</span></code> devices, it is also possible to pass the device <em>object</em> itself,
as opposed to a field name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LiveTable</span><span class="p">([</span><span class="n">motor</span><span class="p">])</span>
</pre></div>
</div>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">LiveTable</span></code> obtains the name(s) of the field(s) produced by
reading <code class="docutils literal notranslate"><span class="pre">motor</span></code>. You can do this yourself too:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="nb">list</span><span class="p">(</span><span class="n">motor</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="gh">Out[5]: </span><span class="go">[&#39;motor&#39;, &#39;motor_setpoint&#39;]</span>
</pre></div>
</div>
<p>In the general case, a device can produce tens or even hundreds of separate
readings, and it can be useful to spell out specific fields rather than a whole
device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the field &#39;motor&#39;, in quotes, not the device, motor</span>
<span class="n">LiveTable</span><span class="p">([</span><span class="s1">&#39;motor&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>In fact, almost all other callbacks (including <a class="reference internal" href="#liveplot"><span class="std std-ref">LivePlot (for scalar data)</span></a>) <em>require</em> a
specific field. They will not accept a device because it may have more than one
field.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For compatibility between <code class="docutils literal notranslate"><span class="pre">ophyd</span></code> devices, which are implemented using
synchronous functions, and <code class="docutils literal notranslate"><span class="pre">ophyd-async</span></code> devices, which are implemented using
coroutines, it is recommended to always specify a signal name rather than a
device object in the <code class="docutils literal notranslate"><span class="pre">LiveTable</span></code> callback.</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.LiveTable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.</span></span><span class="sig-name descname"><span class="pre">LiveTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream_name='primary'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">print_header_interval=50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_width=12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_prec=3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_pad=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator_lines=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logbook=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out=&lt;built-in</span> <span class="pre">function</span> <span class="pre">print&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/core.html#LiveTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.LiveTable" title="Link to this definition">#</a></dt>
<dd><p>Live updating table</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>fields</strong><span class="classifier">list</span></dt><dd><p>List of fields to add to the table.</p>
</dd>
<dt><strong>stream_name</strong><span class="classifier">str, optional</span></dt><dd><p>The event stream to watch for</p>
</dd>
<dt><strong>print_header_interval</strong><span class="classifier">int, optional</span></dt><dd><p>Reprint the header every this many lines, defaults to 50</p>
</dd>
<dt><strong>min_width</strong><span class="classifier">int, optional</span></dt><dd><p>The minimum width is spaces of the data columns.  Defaults to 12</p>
</dd>
<dt><strong>default_prec</strong><span class="classifier">int, optional</span></dt><dd><p>Precision to use if it can not be found in descriptor, defaults to 3</p>
</dd>
<dt><strong>extra_pad</strong><span class="classifier">int, optional</span></dt><dd><p>Number of extra spaces to put around the printed data, defaults to 1</p>
</dd>
<dt><strong>separator_lines</strong><span class="classifier">bool, optional</span></dt><dd><p>Add empty lines before and after the printed table, default True</p>
</dd>
<dt><strong>logbook</strong><span class="classifier">callable, optional</span></dt><dd><p>Must take a sting as the first positional argument</p>
<blockquote>
<div><dl class="simple">
<dt>def logbook(input_str):</dt><dd><p>pass</p>
</dd>
</dl>
</div></blockquote>
</dd>
<dt><strong>out</strong><span class="classifier">callable, optional</span></dt><dd><p>Function to call to ‘print’ a line.  Defaults to <cite>print</cite></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="aside-making-plots-update-live">
<span id="kickers"></span><h3>Aside: Making plots update live<a class="headerlink" href="#aside-making-plots-update-live" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are a user working with a pre-configured setup, you can probably
skip this. Come back if your plots are not appearing / updating.</p>
<p>This configuration is typically performed in an IPython profile startup
script so that is happens automatically at startup time.</p>
</div>
<p>To make plots live-update while the RunEngine is executing a plan, you have run
this command once. In an IPython terminal, the command is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">qt</span>
<span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">install_qt_kicker</span>
<span class="n">install_qt_kicker</span><span class="p">()</span>
</pre></div>
</div>
<p>If you are using a Jupyter notebook, the command is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">notebook</span>
<span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">install_nb_kicker</span>
<span class="n">install_nb_kicker</span><span class="p">()</span>
</pre></div>
</div>
<p>Why? The RunEngine and matplotlib (technically, matplotlib’s Qt backend) both
use an event loop. The RunEngine takes control of the event loop while it is
executing a plan. The kicker function periodically “kicks” the Qt event loop so
that the plots can re-draw while the RunEngine is running.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">...</span></code> command is standard setup, having nothing to do with
bluesky in particular. See
<a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=matplotlib#magic-matplotlib">the relevant section of the IPython documentation</a>
for details.</p>
<dl class="py function">
<dt class="sig sig-object py" id="bluesky.utils.install_kicker">
<span class="sig-prename descclassname"><span class="pre">bluesky.utils.</span></span><span class="sig-name descname"><span class="pre">install_kicker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/utils.html#install_kicker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.utils.install_kicker" title="Link to this definition">#</a></dt>
<dd><p>Install a periodic callback to integrate drawing and asyncio event loops.</p>
<p>This dispatches to <a class="reference internal" href="#bluesky.utils.install_qt_kicker" title="bluesky.utils.install_qt_kicker"><code class="xref py py-func docutils literal notranslate"><span class="pre">install_qt_kicker()</span></code></a> or <a class="reference internal" href="#bluesky.utils.install_nb_kicker" title="bluesky.utils.install_nb_kicker"><code class="xref py py-func docutils literal notranslate"><span class="pre">install_nb_kicker()</span></code></a>
depending on the current matplotlib backend.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>loop</strong><span class="classifier">event loop, optional</span></dt><dd></dd>
<dt><strong>update_rate</strong><span class="classifier">number</span></dt><dd><p>Seconds between periodic updates. Default is 0.03.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bluesky.utils.install_qt_kicker">
<span class="sig-prename descclassname"><span class="pre">bluesky.utils.</span></span><span class="sig-name descname"><span class="pre">install_qt_kicker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/utils.html#install_qt_kicker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.utils.install_qt_kicker" title="Link to this definition">#</a></dt>
<dd><p>Install a periodic callback to integrate Qt and asyncio event loops.</p>
<p>DEPRECATED: This functionality is now handled automatically by default and
is configurable via the RunEngine’s new <code class="docutils literal notranslate"><span class="pre">during_task</span></code> parameter. Calling
this function now has no effect. It will be removed in a future release of
bluesky.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>loop</strong><span class="classifier">event loop, optional</span></dt><dd></dd>
<dt><strong>update_rate</strong><span class="classifier">number</span></dt><dd><p>Seconds between periodic updates. Default is 0.03.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bluesky.utils.install_nb_kicker">
<span class="sig-prename descclassname"><span class="pre">bluesky.utils.</span></span><span class="sig-name descname"><span class="pre">install_nb_kicker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/utils.html#install_nb_kicker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.utils.install_nb_kicker" title="Link to this definition">#</a></dt>
<dd><p>Install a periodic callback to integrate ipykernel and asyncio event loops.</p>
<p>It is safe to call this function multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>loop</strong><span class="classifier">event loop, optional</span></dt><dd></dd>
<dt><strong>update_rate</strong><span class="classifier">number</span></dt><dd><p>Seconds between periodic updates. Default is 0.03.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="liveplot-for-scalar-data">
<span id="liveplot"></span><h3>LivePlot (for scalar data)<a class="headerlink" href="#liveplot-for-scalar-data" title="Link to this heading">#</a></h3>
<p>Plot scalars. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.mpl_plotting</span> <span class="kn">import</span> <span class="n">LivePlot</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-1.png" class="plot-directive" src="_images/callbacks-1.png" />
</figure>
<p>To customize style, pass in any
<a class="reference external" href="http://matplotlib.org/api/lines_api.html#module-matplotlib.lines">matplotlib line style keyword argument</a>.
(<code class="docutils literal notranslate"><span class="pre">LivePlot</span></code> will pass it through to <code class="docutils literal notranslate"><span class="pre">Axes.plot</span></code>.) Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
   <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-2.png" class="plot-directive" src="_images/callbacks-2.png" />
</figure>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.mpl_plotting.LivePlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.mpl_plotting.</span></span><span class="sig-name descname"><span class="pre">LivePlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epoch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'run'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/mpl_plotting.html#LivePlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.mpl_plotting.LivePlot" title="Link to this definition">#</a></dt>
<dd><p>Build a function that updates a plot from a stream of Events.</p>
<p>Note: If your figure blocks the main thread when you are trying to
scan with this callback, call <cite>plt.ion()</cite> in your IPython session.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>y</strong><span class="classifier">str</span></dt><dd><p>the name of a data field in an Event</p>
</dd>
<dt><strong>x</strong><span class="classifier">str, optional</span></dt><dd><p>the name of a data field in an Event, or ‘seq_num’ or ‘time’
If None, use the Event’s sequence number.
Special case: If the Event’s data includes a key named ‘seq_num’ or
‘time’, that takes precedence over the standard ‘seq_num’ and ‘time’
recorded in every Event.</p>
</dd>
<dt><strong>legend_keys</strong><span class="classifier">list, optional</span></dt><dd><p>The list of keys to extract from the RunStart document and format
in the legend of the plot. The legend will always show the
scan_id followed by a colon (“1: “).  Each</p>
</dd>
<dt><strong>xlim</strong><span class="classifier">tuple, optional</span></dt><dd><p>passed to Axes.set_xlim</p>
</dd>
<dt><strong>ylim</strong><span class="classifier">tuple, optional</span></dt><dd><p>passed to Axes.set_ylim</p>
</dd>
<dt><strong>ax</strong><span class="classifier">Axes, optional</span></dt><dd><p>matplotib Axes; if none specified, new figure and axes are made.</p>
</dd>
<dt><strong>fig</strong><span class="classifier">Figure, optional</span></dt><dd><p>deprecated: use ax instead</p>
</dd>
<dt><strong>epoch</strong><span class="classifier">{‘run’, ‘unix’}, optional</span></dt><dd><p>If ‘run’ t=0 is the time recorded in the RunStart document. If ‘unix’,
t=0 is 1 Jan 1970 (“the UNIX epoch”). Default is ‘run’.</p>
</dd>
<dt><strong>All additional keyword arguments are passed through to ``Axes.plot``.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_plotter</span> <span class="o">=</span> <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">legend_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span><span class="p">(</span><span class="n">my_scan</span><span class="p">,</span> <span class="n">my_plotter</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="live-image">
<h3>Live Image<a class="headerlink" href="#live-image" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.broker.LiveImage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.broker.</span></span><span class="sig-name descname"><span class="pre">LiveImage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_redraw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/broker.html#LiveImage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.broker.LiveImage" title="Link to this definition">#</a></dt>
<dd><p>Stream 2D images in a cross-section viewer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>field</strong><span class="classifier">string</span></dt><dd><p>name of data field in an Event</p>
</dd>
<dt><strong>fs: Registry instance</strong></dt><dd><p>The Registry instance to pull the data from</p>
</dd>
<dt><strong>cmap</strong><span class="classifier">str,  colormap, or None</span></dt><dd><p>color map to use.  Defaults to gray</p>
</dd>
<dt><strong>norm</strong><span class="classifier">Normalize or None</span></dt><dd><p>Normalization function to use</p>
</dd>
<dt><strong>limit_func</strong><span class="classifier">callable, optional</span></dt><dd><p>function that takes in the image and returns clim values</p>
</dd>
<dt><strong>auto_redraw</strong><span class="classifier">bool, optional</span></dt><dd></dd>
<dt><strong>interpolation</strong><span class="classifier">str, optional</span></dt><dd><p>Interpolation method to use. List of valid options can be found in
CrossSection2DView.interpolation</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="livegrid-gridded-heat-map">
<span id="liveraster"></span><h3>LiveGrid (gridded heat map)<a class="headerlink" href="#livegrid-gridded-heat-map" title="Link to this heading">#</a></h3>
<p>Plot a scalar value as a function of two variables on a regular grid. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">grid_scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det4</span><span class="p">,</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.mpl_plotting</span> <span class="kn">import</span> <span class="n">LiveGrid</span>

<span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det4</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
   <span class="n">LiveGrid</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;det4&#39;</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-3.png" class="plot-directive" src="_images/callbacks-3.png" />
</figure>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.mpl_plotting.LiveGrid">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.mpl_plotting.</span></span><span class="sig-name descname"><span class="pre">LiveGrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raster_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'x'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aspect</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'equal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_positive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_positive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'up'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/mpl_plotting.html#LiveGrid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.mpl_plotting.LiveGrid" title="Link to this definition">#</a></dt>
<dd><p>Plot gridded 2D data in a “heat map”.</p>
<p>This assumes that readings are placed on a regular grid and can be placed
into an image by sequence number. The seq_num is used to determine which
pixel to fill in.</p>
<p>For non-gridded data with arbitrary placement, use
<a class="reference internal" href="#bluesky.callbacks.mpl_plotting.LiveScatter" title="bluesky.callbacks.mpl_plotting.LiveScatter"><code class="xref py py-func docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveScatter()</span></code></a>.</p>
<p>This simply wraps around a <cite>AxesImage</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>raster_shape</strong><span class="classifier">tuple</span></dt><dd><p>The (row, col) shape of the raster</p>
</dd>
<dt><strong>I</strong><span class="classifier">str</span></dt><dd><p>The field to use for the color of the markers</p>
</dd>
<dt><strong>clim</strong><span class="classifier">tuple, optional</span></dt><dd><p>The color limits</p>
</dd>
<dt><strong>cmap</strong><span class="classifier">str or colormap, optional</span></dt><dd><p>The color map to use</p>
</dd>
<dt><strong>xlabel, ylabel</strong><span class="classifier">str, optional</span></dt><dd><p>Labels for the x and y axis</p>
</dd>
<dt><strong>extent</strong><span class="classifier">scalars (left, right, bottom, top), optional</span></dt><dd><p>Passed through to <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.imshow.html#matplotlib.axes.Axes.imshow" title="(in Matplotlib v3.9.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">matplotlib.axes.Axes.imshow()</span></code></a></p>
</dd>
<dt><strong>aspect</strong><span class="classifier">str or float, optional</span></dt><dd><p>Passed through to <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.imshow.html#matplotlib.axes.Axes.imshow" title="(in Matplotlib v3.9.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">matplotlib.axes.Axes.imshow()</span></code></a></p>
</dd>
<dt><strong>ax</strong><span class="classifier">Axes, optional</span></dt><dd><p>matplotib Axes; if none specified, new figure and axes are made.</p>
</dd>
<dt><strong>x_positive: string, optional</strong></dt><dd><p>Defines the positive direction of the x axis, takes the values ‘right’
(default) or ‘left’.</p>
</dd>
<dt><strong>y_positive: string, optional</strong></dt><dd><p>Defines the positive direction of the y axis, takes the values ‘up’
(default) or ‘down’.</p>
</dd>
<dt><strong>title</strong><span class="classifier">string, optional</span></dt><dd><p>Override title of plot. If None (default), title is generated from the scan
ID. Set to empty string to remove title.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#bluesky.callbacks.mpl_plotting.LiveScatter" title="bluesky.callbacks.mpl_plotting.LiveScatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveScatter</span></code></a></dt><dd></dd>
</dl>
</div>
</dd></dl>

</section>
<section id="livescatter-scattered-heat-map">
<h3>LiveScatter (scattered heat map)<a class="headerlink" href="#livescatter-scattered-heat-map" title="Link to this heading">#</a></h3>
<p>Plot a scalar value as a function of two variables. Unlike
<a class="reference internal" href="#bluesky.callbacks.mpl_plotting.LiveGrid" title="bluesky.callbacks.mpl_plotting.LiveGrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveGrid</span></code></a>, this does not assume a regular grid.
Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">grid_scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det5</span><span class="p">,</span> <span class="n">jittery_motor1</span><span class="p">,</span> <span class="n">jittery_motor2</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.mpl_plotting</span> <span class="kn">import</span> <span class="n">LiveScatter</span>

<span class="c1"># The &#39;jittery&#39; example motors won&#39;t go exactly where they are told to go.</span>

<span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det5</span><span class="p">],</span>
                      <span class="n">jittery_motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                      <span class="n">jittery_motor2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
   <span class="n">LiveScatter</span><span class="p">(</span><span class="s1">&#39;jittery_motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;jittery_motor2&#39;</span><span class="p">,</span> <span class="s1">&#39;det5&#39;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-4.png" class="plot-directive" src="_images/callbacks-4.png" />
</figure>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.mpl_plotting.LiveScatter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.mpl_plotting.</span></span><span class="sig-name descname"><span class="pre">LiveScatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/mpl_plotting.html#LiveScatter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.mpl_plotting.LiveScatter" title="Link to this definition">#</a></dt>
<dd><p>Plot scattered 2D data in a “heat map”.</p>
<p>Alternatively, if the data is placed on a regular grid, you can use
<a class="reference internal" href="#bluesky.callbacks.mpl_plotting.LiveGrid" title="bluesky.callbacks.mpl_plotting.LiveGrid"><code class="xref py py-func docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveGrid()</span></code></a>.</p>
<p>This simply wraps around a <cite>PathCollection</cite> as generated by scatter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>x, y</strong><span class="classifier">str</span></dt><dd><p>The fields to use for the x and y data</p>
</dd>
<dt><strong>I</strong><span class="classifier">str</span></dt><dd><p>The field to use for the color of the markers</p>
</dd>
<dt><strong>xlim, ylim, clim</strong><span class="classifier">tuple, optional</span></dt><dd><p>The x, y and color limits respectively</p>
</dd>
<dt><strong>cmap</strong><span class="classifier">str or colormap, optional</span></dt><dd><p>The color map to use</p>
</dd>
<dt><strong>ax</strong><span class="classifier">Axes, optional</span></dt><dd><p>matplotib Axes; if none specified, new figure and axes are made.</p>
</dd>
<dt><strong>All additional keyword arguments are passed through to ``Axes.scatter``.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#bluesky.callbacks.mpl_plotting.LiveGrid" title="bluesky.callbacks.mpl_plotting.LiveGrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">bluesky.callbacks.mpl_plotting.LiveGrid</span></code></a></dt><dd></dd>
</dl>
</div>
</dd></dl>

</section>
<section id="livefit">
<h3>LiveFit<a class="headerlink" href="#livefit" title="Link to this heading">#</a></h3>
<p>Perform a nonlinear least squared best fit to the data with a user-defined
model function. The function can depend on any number of independent variables.
We integrate with the package
<a class="reference external" href="https://lmfit.github.io/lmfit-py/model.html">lmfit</a>, which provides a nice
interface for NLS minimization.</p>
<p>In this example, we fit a Gaussian to detector readings as a function of motor
position. First, define a Gaussian function, create an <code class="docutils literal notranslate"><span class="pre">lmfit.Model</span></code> from it,
and provide initial guesses for the parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">lmfit</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>
<span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
              <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">}</span>
</pre></div>
</div>
<p>The guesses can be given as plain numbers or as <code class="docutils literal notranslate"><span class="pre">lmfit.Parameter</span></code> objects, as
in the case of ‘sigma’ above, to specify constraints.</p>
<p>To integrate with the bluesky we need to provide:</p>
<ul class="simple">
<li><p>the field with the dependent variable (in this example, <code class="docutils literal notranslate"><span class="pre">'noisy_det'</span></code>)</p></li>
<li><p>a mapping between the name(s) of independent variable(s) in
the function (<code class="docutils literal notranslate"><span class="pre">'x'</span></code>) to the corresponding field(s) in the data
(<code class="docutils literal notranslate"><span class="pre">'motor'</span></code>)</p></li>
<li><p>any initial guesses expected by the model (defined above)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span><span class="p">,</span> <span class="n">noisy_det</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveFit</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;noisy_det&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;motor&#39;</span><span class="p">},</span> <span class="n">init_guess</span><span class="p">)</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">noisy_det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">lf</span><span class="p">)</span>
<span class="c1"># best-fit values for &#39;A&#39;, &#39;sigma&#39; and &#39;x0&#39; are in lf.result.values</span>
</pre></div>
</div>
<p>The fit results are accessible in the <code class="docutils literal notranslate"><span class="pre">result</span></code> attribute of the callback.
For example, the center of the Gaussian is <code class="docutils literal notranslate"><span class="pre">lf.result.values['x0']</span></code>. This
could be used in a next step, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span>
<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">noisy_det</span><span class="p">],</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p>Refer the
<a class="reference external" href="https://lmfit.github.io/lmfit-py/model.html#the-modelresult-class">lmfit documentation</a>
for more about <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p>
<p>This example uses a model with two independent variables, x and y.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">det4</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Specify the names of the independent variables to Model.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">gaussian</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>

<span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
              <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span>
              <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;det4&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;motor2&#39;</span><span class="p">},</span> <span class="n">init_guess</span><span class="p">)</span>

<span class="c1"># Scan a 2D mesh.</span>
<span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det4</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
   <span class="n">lf</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the fit is recomputed every time a new data point is available. See
the API documentation below for other options. Fitting does not commence until
the number of accumulated data points is equal to the number of free parameters
in the model.</p>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.LiveFit">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.</span></span><span class="sig-name descname"><span class="pre">LiveFit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">independent_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_guess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_every</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/fitting.html#LiveFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.LiveFit" title="Link to this definition">#</a></dt>
<dd><p>Fit a model to data using nonlinear least-squares minimization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">lmfit.Model</span></dt><dd></dd>
<dt><strong>y</strong><span class="classifier">string</span></dt><dd><p>name of the field in the Event document that is the dependent variable</p>
</dd>
<dt><strong>independent_vars</strong><span class="classifier">dict</span></dt><dd><p>map the independent variable name(s) in the model to the field(s)
in the Event document; e.g., <code class="docutils literal notranslate"><span class="pre">{'x':</span> <span class="pre">'motor'}</span></code></p>
</dd>
<dt><strong>init_guess</strong><span class="classifier">dict, optional</span></dt><dd><p>initial guesses for other values, if expected by model;
e.g., <code class="docutils literal notranslate"><span class="pre">{'sigma':</span> <span class="pre">1}</span></code></p>
</dd>
<dt><strong>update_every</strong><span class="classifier">int or None, optional</span></dt><dd><p>How often to recompute the fit. If <cite>None</cite>, do not compute until the
end. Default is 1 (recompute after each new point).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>result</strong><span class="classifier">lmfit.ModelResult</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="livefitplot">
<h3>LiveFitPlot<a class="headerlink" href="#livefitplot" title="Link to this heading">#</a></h3>
<p>This is a variation on <code class="docutils literal notranslate"><span class="pre">LivePlot</span></code> that plots the best fit curve from
<code class="docutils literal notranslate"><span class="pre">LiveFit</span></code>. It applies to 1D model functions only.</p>
<p>Repeating the example from <code class="docutils literal notranslate"><span class="pre">LiveFit</span></code> above, adding a plot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># same as above...</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">lmfit</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span><span class="p">,</span> <span class="n">noisy_det</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveFit</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>
<span class="n">init_guess</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
              <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">}</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">LiveFit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;noisy_det&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;motor&#39;</span><span class="p">},</span> <span class="n">init_guess</span><span class="p">)</span>

<span class="c1"># now add the plot...</span>

<span class="kn">from</span> <span class="nn">bluesky.callbacks.mpl_plotting</span> <span class="kn">import</span> <span class="n">LiveFitPlot</span>
<span class="n">lpf</span> <span class="o">=</span> <span class="n">LiveFitPlot</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">noisy_det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">lfp</span><span class="p">)</span>

<span class="c1"># Notice that we did&#39;nt need to subscribe lf directly, just lfp.</span>
<span class="c1"># But, as before, the results are in lf.result.</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-5.png" class="plot-directive" src="_images/callbacks-5.png" />
</figure>
<p>We can use the standard <code class="docutils literal notranslate"><span class="pre">LivePlot</span></code> to show the data on the same axes.
Notice that they can styled independently.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># explitly create figure, axes to use below</span>
<span class="n">lfp</span> <span class="o">=</span> <span class="n">LiveFitPlot</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;noisy_det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">noisy_det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">[</span><span class="n">lp</span><span class="p">,</span> <span class="n">lfp</span><span class="p">])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-6.png" class="plot-directive" src="_images/callbacks-6.png" />
</figure>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.mpl_plotting.LiveFitPlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.mpl_plotting.</span></span><span class="sig-name descname"><span class="pre">LiveFitPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">livefit</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/mpl_plotting.html#LiveFitPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.mpl_plotting.LiveFitPlot" title="Link to this definition">#</a></dt>
<dd><p>Add a plot to an instance of LiveFit.</p>
<p>Note: If your figure blocks the main thread when you are trying to
scan with this callback, call <cite>plt.ion()</cite> in your IPython session.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>livefit</strong><span class="classifier">LiveFit</span></dt><dd><p>an instance of <code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></p>
</dd>
<dt><strong>num_points</strong><span class="classifier">int, optional</span></dt><dd><p>number of points to sample when evaluating the model; default 100</p>
</dd>
<dt><strong>legend_keys</strong><span class="classifier">list, optional</span></dt><dd><p>The list of keys to extract from the RunStart document and format
in the legend of the plot. The legend will always show the
scan_id followed by a colon (“1: “).  Each</p>
</dd>
<dt><strong>xlim</strong><span class="classifier">tuple, optional</span></dt><dd><p>passed to Axes.set_xlim</p>
</dd>
<dt><strong>ylim</strong><span class="classifier">tuple, optional</span></dt><dd><p>passed to Axes.set_ylim</p>
</dd>
<dt><strong>ax</strong><span class="classifier">Axes, optional</span></dt><dd><p>matplotib Axes; if none specified, new figure and axes are made.</p>
</dd>
<dt><strong>All additional keyword arguments are passed through to ``Axes.plot``.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="peakstats">
<h3>PeakStats<a class="headerlink" href="#peakstats" title="Link to this heading">#</a></h3>
<p>Compute statistics of peak-like data. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.fitting</span> <span class="kn">import</span> <span class="n">PeakStats</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span><span class="p">,</span> <span class="n">det</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">PeakStats</span><span class="p">(</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="s1">&#39;det&#39;</span><span class="p">)</span>
<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ps</span><span class="p">)</span>
</pre></div>
</div>
<p>Now attributes of <code class="docutils literal notranslate"><span class="pre">ps</span></code>, documented below, contain various peak statistics.
There is also a convenience function for plotting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.mpl_plotting</span> <span class="kn">import</span> <span class="n">plot_peak_stats</span>

<span class="n">plot_peak_stats</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-7.png" class="plot-directive" src="_images/callbacks-7.png" />
</figure>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.fitting.PeakStats">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.fitting.</span></span><span class="sig-name descname"><span class="pre">PeakStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calc_derivative_and_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/fitting.html#PeakStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.fitting.PeakStats" title="Link to this definition">#</a></dt>
<dd><p>Compute peak statsitics after a run finishes.</p>
<p>Results are stored in the attributes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>x</strong><span class="classifier">string</span></dt><dd><p>field name for the x variable (e.g., a motor)</p>
</dd>
<dt><strong>y</strong><span class="classifier">string</span></dt><dd><p>field name for the y variable (e.g., a detector)</p>
</dd>
<dt><strong>calc_derivative_and_stats</strong><span class="classifier">bool, optional</span></dt><dd><p>calculate derivative of the readings and its stats. False by default.</p>
</dd>
<dt><strong>edge_count</strong><span class="classifier">int or None, optional</span></dt><dd><p>If not None, number of points at beginning and end to use
for quick and dirty background subtraction.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>com</strong><span class="classifier">center of mass</span></dt><dd></dd>
<dt><strong>cen</strong><span class="classifier">mid-point between half-max points on each side of the peak</span></dt><dd></dd>
<dt><strong>max</strong><span class="classifier">x location of y maximum</span></dt><dd></dd>
<dt><strong>min</strong><span class="classifier">x location of y minimum</span></dt><dd></dd>
<dt><strong>crossings</strong><span class="classifier">crosses between y and middle line, which is</span></dt><dd><p>((np.max(y) + np.min(y)) / 2). Users can estimate FWHM based
on those info.</p>
</dd>
<dt><strong>fwhm</strong><span class="classifier">the computed full width half maximum (fwhm) of a peak.</span></dt><dd><p>The distance between the first and last crossing is taken to
be the fwhm.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>It is assumed that the two fields, x and y, are recorded in the same
Event stream.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bluesky.callbacks.mpl_plotting.plot_peak_stats">
<span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.mpl_plotting.</span></span><span class="sig-name descname"><span class="pre">plot_peak_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">peak_stats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/mpl_plotting.html#plot_peak_stats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.mpl_plotting.plot_peak_stats" title="Link to this definition">#</a></dt>
<dd><p>Plot data and various peak statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>peak_stats</strong><span class="classifier">PeakStats</span></dt><dd></dd>
<dt><strong>ax</strong><span class="classifier">matplotlib.Axes, optional</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>arts</strong><span class="classifier">dict</span></dt><dd><p>dictionary of matplotlib Artist objects, for further styling</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="best-effort-callback">
<span id="id2"></span><h2>Best-Effort Callback<a class="headerlink" href="#best-effort-callback" title="Link to this heading">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a new, experimental feature. It will likely be changed in future
releases in a way that is not backward-compatible.</p>
</div>
<p>This is meant to be permanently subscribed to the RunEngine like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># one-time configuration</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>
<span class="n">bec</span> <span class="o">=</span> <span class="n">BestEffortCallback</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">bec</span><span class="p">)</span>
</pre></div>
</div>
<p>It provides best-effort plots and visualization for <em>any</em> plan. It uses the
‘hints’ key provided by the plan, if present. (See the source code of the
plans in <code class="xref py py-mod docutils literal notranslate"><span class="pre">bluesky.plans</span></code> for examples.)</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det1</span><span class="p">,</span> <span class="n">det2</span>

<span class="gp">In [7]: </span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>

<span class="gp">In [8]: </span><span class="n">dets</span> <span class="o">=</span> <span class="p">[</span><span class="n">det1</span><span class="p">,</span> <span class="n">det2</span><span class="p">]</span>

<span class="gp">In [9]: </span><span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># automatically prints table, shows plot</span>


<span class="go">Transient Scan ID: 2     Time: 2024-10-29 14:03:41</span>
<span class="go">Persistent Unique Scan ID: &#39;e3e8bfcf-d6c7-4bde-940a-ddf08abc8f7b&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |      motor |       det1 |       det2 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|         1 | 14:03:41.2 |      1.000 |      0.000 |      0.271 |</span>
<span class="go">|         2 | 14:03:41.5 |      2.000 |      0.000 |      0.271 |</span>
<span class="go">|         3 | 14:03:41.7 |      3.000 |      0.000 |      0.271 |</span>
<span class="go">|         4 | 14:03:41.9 |      4.000 |      0.000 |      0.271 |</span>
<span class="go">|         5 | 14:03:42.2 |      5.000 |      0.000 |      0.271 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">generator scan [&#39;e3e8bfcf&#39;] (scan num: 2)</span>



<span class="gh">Out[9]: </span><span class="go">(&#39;e3e8bfcf-d6c7-4bde-940a-ddf08abc8f7b&#39;,)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/callbacks-8.png" class="plot-directive" src="_images/callbacks-8.png" />
</figure>
<p>Use these methods to toggle on or off parts of the functionality.</p>
<div class="pst-scrollable-table-container"><table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.html#bluesky.callbacks.best_effort.BestEffortCallback" title="bluesky.callbacks.best_effort.BestEffortCallback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback</span></code></a>(*[, fig_factory, ...])</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.enable_heading.html#bluesky.callbacks.best_effort.BestEffortCallback.enable_heading" title="bluesky.callbacks.best_effort.BestEffortCallback.enable_heading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.enable_heading</span></code></a>()</p></td>
<td><p>Print timestamp and IDs at the top of a run.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.disable_heading.html#bluesky.callbacks.best_effort.BestEffortCallback.disable_heading" title="bluesky.callbacks.best_effort.BestEffortCallback.disable_heading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.disable_heading</span></code></a>()</p></td>
<td><p>Opposite of enable_heading()</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.enable_table.html#bluesky.callbacks.best_effort.BestEffortCallback.enable_table" title="bluesky.callbacks.best_effort.BestEffortCallback.enable_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.enable_table</span></code></a>()</p></td>
<td><p>Print hinted readings from the 'primary' stream in a LiveTable.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.disable_table.html#bluesky.callbacks.best_effort.BestEffortCallback.disable_table" title="bluesky.callbacks.best_effort.BestEffortCallback.disable_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.disable_table</span></code></a>()</p></td>
<td><p>Opposite of enable_table()</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.enable_baseline.html#bluesky.callbacks.best_effort.BestEffortCallback.enable_baseline" title="bluesky.callbacks.best_effort.BestEffortCallback.enable_baseline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.enable_baseline</span></code></a>()</p></td>
<td><p>Print hinted fields from the 'baseline' stream.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.disable_baseline.html#bluesky.callbacks.best_effort.BestEffortCallback.disable_baseline" title="bluesky.callbacks.best_effort.BestEffortCallback.disable_baseline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.disable_baseline</span></code></a>()</p></td>
<td><p>Opposite of enable_baseline()</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.enable_plots.html#bluesky.callbacks.best_effort.BestEffortCallback.enable_plots" title="bluesky.callbacks.best_effort.BestEffortCallback.enable_plots"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.enable_plots</span></code></a>()</p></td>
<td><p>Plot hinted fields from all streams not in <code class="docutils literal notranslate"><span class="pre">noplot_streams</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky.callbacks.best_effort.BestEffortCallback.disable_plots.html#bluesky.callbacks.best_effort.BestEffortCallback.disable_plots" title="bluesky.callbacks.best_effort.BestEffortCallback.disable_plots"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BestEffortCallback.disable_plots</span></code></a>()</p></td>
<td><p>Do not plot anything.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Blacklist plotting certain streams using the <code class="docutils literal notranslate"><span class="pre">bec.noplot_streams</span></code> attribute,
which is a list of stream names.  The blacklist is set to <code class="docutils literal notranslate"><span class="pre">['baseline']</span></code> by
default.</p>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">bec.overplot</span></code> can be used to control whether line plots for
subsequent runs are plotted on the same axes. It is <code class="docutils literal notranslate"><span class="pre">True</span></code> by default.
Overplotting only occurs if the names of the axes are the same from one plot
to the next.</p>
<section id="peak-stats">
<h3>Peak Stats<a class="headerlink" href="#peak-stats" title="Link to this heading">#</a></h3>
<p>For each plot, simple peak-fitting is performed in the background. Of
course, it may or may not be applicable depending on your data, and it is
not shown by default. To view fitting annotations in a plot, click the
plot area and press Shift+P. (Lowercase p is a shortcut for
“panning” the plot.)</p>
<p>To access the peak-fit statistics programmatically, use <code class="docutils literal notranslate"><span class="pre">bec.peaks</span></code>.</p>
</section>
<section id="hints">
<span id="id3"></span><h3>Hints<a class="headerlink" href="#hints" title="Link to this heading">#</a></h3>
<p>The best-effort callback aims to print and plot useful information without
being overwhelmingly comprehensive. Its usefulness is improved and tuned by the
<code class="docutils literal notranslate"><span class="pre">hints</span></code> attribute on devices (if available) and <code class="docutils literal notranslate"><span class="pre">hints</span></code> metadata injected
by plans (if available). If either or both of these are not available, the
best-effort callback still makes a best effort to display something useful.</p>
<p>The contents of hints <em>do not at all affect what data is saved</em>. The content
only affect what is displayed automatically by the best-effort callback and
other tools that opt to look at the hints. Additional callbacks may still be
set up for live or <em>post-facto</em> visualization or processing that do more
specific things without relying on hints.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hints</span></code> attribute or property on devices is a dictionary with the key
<code class="docutils literal notranslate"><span class="pre">'fields'</span></code> mapped to a list of fields.</p>
<p>On movable devices such as motors or temperature controllers, these fields are
expected to comprise the independent axes of the device. A motor that reads
the fields <code class="docutils literal notranslate"><span class="pre">['x',</span> <span class="pre">'x_setpoint']</span></code> might provide the hint <code class="docutils literal notranslate"><span class="pre">{'fields':</span> <span class="pre">['x']}</span></code>
to indicate that it has one independent axis and that the field <code class="docutils literal notranslate"><span class="pre">x</span></code> is the best
representation of its value.</p>
<p>A readable device might report many fields like
<code class="docutils literal notranslate"><span class="pre">['chan1',</span> <span class="pre">'chan2',</span> <span class="pre">'chan3',</span> <span class="pre">'chan4',</span> <span class="pre">'chan5']</span></code> but perhaps only a couple are
usually interesting. A useful hint might narrow them down to
<code class="docutils literal notranslate"><span class="pre">{'fields':</span> <span class="pre">['chan1',</span> <span class="pre">'chan2']}</span></code> so that a “best-effort” plot does not
display an overwhelming amount of information.</p>
<p>The hints provided by the devices are read by the RunEngine and collated in the
<a class="reference internal" href="event_descriptors.html"><span class="doc">Event Descriptor documents</span></a>.</p>
<p>The plans generally know which devices are being used as dependent and
independent variables (i.e., which are being “scanned” over), and they may
provide this information via a <code class="docutils literal notranslate"><span class="pre">'hints'</span></code> metadata key that they inject into
the start document along with the rest of their metadata. Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The pattern is</span>
<span class="c1"># {&#39;dimensions&#39;: [(fields, stream_name), (fields, stream_name), ...]}</span>

<span class="c1"># a scan over time</span>
<span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="p">[((</span><span class="s1">&#39;time&#39;</span><span class="p">,),</span> <span class="s1">&#39;primary&#39;</span><span class="p">)]}</span>

<span class="c1"># a one-dimensional scan</span>
<span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">motor</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">],</span> <span class="s1">&#39;primary&#39;</span><span class="p">)]}</span>

<span class="c1"># a two-dimensional scan</span>
<span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">x_motor</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">],</span> <span class="s1">&#39;primary&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">y_motor</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">],</span> <span class="s1">&#39;primary&#39;</span><span class="p">)]}</span>

<span class="c1"># an N-dimensional scan</span>
<span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">motor</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">],</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">motor</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">]}</span>
</pre></div>
</div>
<p>It’s possible to adjust hints interactively, but they are generally intended to
be set in a startup file. Err on the side of displaying more information than
you need to see, and you will rarely need to adjust them.</p>
<p>Plans may also hint that their data is sampled on a regular rectangular grid
via the hint <code class="docutils literal notranslate"><span class="pre">{'gridding':</span> <span class="pre">'rectilinear'}</span></code>. This is useful, for example, for
decided whether to visualize 2D data with LiveGrid or with LiveScatter.</p>
</section>
</section>
<section id="callback-for-export">
<span id="export"></span><h2>Callback for Export<a class="headerlink" href="#callback-for-export" title="Link to this heading">#</a></h2>
<section id="exporting-image-data-as-tiff-files">
<h3>Exporting Image Data as TIFF Files<a class="headerlink" href="#exporting-image-data-as-tiff-files" title="Link to this heading">#</a></h3>
<p>First, compose a filename template. The template can include metadata or event
data from the scan.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a template that includes the scan ID and sequence number in each filename</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;output_dir/</span><span class="si">{start[scan_id]}</span><span class="s2">_</span><span class="si">{event[seq_num]}</span><span class="s2">.tiff&quot;</span>

<span class="c1"># a template that sorts files into directories based user and scan ID</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;output_dir/</span><span class="si">{start[user]}</span><span class="s2">/</span><span class="si">{start[scan_id]}</span><span class="s2">/</span><span class="si">{event[seq_num]}</span><span class="s2">.tiff&quot;</span>

<span class="c1"># a more complex template includes actual measurements in the filenames</span>
<span class="n">template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;output_dir/</span><span class="si">{start[scan_id]}</span><span class="s2">_</span><span class="si">{start[sample_name]}</span><span class="s2">_&quot;</span>
            <span class="s2">&quot;</span><span class="si">{event[data][temperature]}</span><span class="s2">_</span><span class="si">{event[seq_num]}</span><span class="s2">.tiff&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Above, we are using a Python language feature called format strings. Notice
that inside the curly brackets we don’t use quotes around the key names; it’s
<code class="docutils literal notranslate"><span class="pre">{event[seq_num]}</span></code> not <code class="docutils literal notranslate"><span class="pre">{event['seq_num']}</span></code>.</p>
<p>If each image data point is actually a stack of 2D image planes, the template
must also include <code class="docutils literal notranslate"><span class="pre">{i}</span></code>, which will count through the image planes in the
stack.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most metadata comes from the “start” document, hence <code class="docutils literal notranslate"><span class="pre">start.scan_id</span></code>
above.  Review the <a class="reference internal" href="documents.html"><span class="doc">Documents</span></a> section for details.</p>
</div>
<p>Create a callback that exports TIFFs using your template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.broker</span> <span class="kn">import</span> <span class="n">LiveTiffExporter</span>

<span class="n">exporter</span> <span class="o">=</span> <span class="n">LiveTiffExporter</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, to export all the images from a run when it finishes running, wrap the
exporter in <code class="docutils literal notranslate"><span class="pre">post_run</span></code> and subscribe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.broker</span> <span class="kn">import</span> <span class="n">post_run</span>

<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">post_run</span><span class="p">(</span><span class="n">exporter</span><span class="p">))</span>
</pre></div>
</div>
<p>It also possible to write TIFFs live, hence the name <code class="docutils literal notranslate"><span class="pre">LiveTiffExporter</span></code>, but
there is an important disadvantage to doing this subscription in the same
process: progress of the experiment may be intermittently slowed while data is
written to disk. In some circumstances, this affect on the timing of the
experiment may not be acceptable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">exporter</span><span class="p">)</span>
</pre></div>
</div>
<p>There are more configuration options available, as given in detail below. It is
recommended to use these expensive callbacks in a separate process.</p>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.broker.LiveTiffExporter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.broker.</span></span><span class="sig-name descname"><span class="pre">LiveTiffExporter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/broker.html#LiveTiffExporter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.broker.LiveTiffExporter" title="Link to this definition">#</a></dt>
<dd><p>Save TIFF files.</p>
<p>Incorporate metadata and data from individual data points in the filenames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>field</strong><span class="classifier">str</span></dt><dd><p>a data key, e.g., ‘image’</p>
</dd>
<dt><strong>template</strong><span class="classifier">str</span></dt><dd><p>A templated file path, where curly brackets will be filled in with
the attributes of ‘start’, ‘event’, and (for image stacks) ‘i’,
a sequential number.
e.g., “dir/scan{start[scan_id]}_by_{start[experimenter]}_{i}.tiff”</p>
</dd>
<dt><strong>dryrun</strong><span class="classifier">bool</span></dt><dd><p>default to False; if True, do not write any files</p>
</dd>
<dt><strong>overwrite</strong><span class="classifier">bool</span></dt><dd><p>default to False, raising an OSError if file exists</p>
</dd>
<dt><strong>db</strong><span class="classifier">Broker, optional</span></dt><dd><p>The databroker instance to use, if not provided use databroker
singleton</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>filenames</strong><span class="classifier">list of filenames written in ongoing or most recent run</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="export-all-data-and-metadata-in-an-hdf5-file">
<h3>Export All Data and Metadata in an HDF5 File<a class="headerlink" href="#export-all-data-and-metadata-in-an-hdf5-file" title="Link to this heading">#</a></h3>
<p>A Stop Document is emitted at the end of every run. Subscribe to it, using it
as a cue to load the dataset via the DataBroker and export an HDF5 file
using <a class="reference external" href="https://nsls-ii.github.io/suitcase">suitcase</a>.</p>
<p>Working example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">DataBroker</span> <span class="k">as</span> <span class="n">db</span>
<span class="kn">import</span> <span class="nn">suitcase</span>

<span class="k">def</span> <span class="nf">suitcase_as_callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">run_start_uid</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;run_start&#39;</span><span class="p">]</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">run_start_uid</span><span class="p">]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.h5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_start_uid</span><span class="p">)</span>
    <span class="n">suitcase</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">suitcase_as_callback</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-metadata-to-the-olog">
<h3>Export Metadata to the Olog<a class="headerlink" href="#export-metadata-to-the-olog" title="Link to this heading">#</a></h3>
<p>The <a class="reference external" href="http://olog.github.io/2.2.7-SNAPSHOT/">Olog</a> (“operational log”) is an
electronic logbook. We can use a callback to automatically generate log entries
at the beginning of a run. The Python interface to Olog is not straightforward,
so there is some boilerplate:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pyOlog</span> <span class="kn">import</span> <span class="n">SimpleOlogClient</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.olog</span> <span class="kn">import</span> <span class="n">logbook_cb_factory</span>

<span class="c1"># Set up the logbook. This configures bluesky&#39;s summaries of</span>
<span class="c1"># data acquisition (scan type, ID, etc.).</span>

<span class="n">LOGBOOKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data Acquisition&#39;</span><span class="p">]</span>  <span class="c1"># list of logbook names to publish to</span>
<span class="n">simple_olog_client</span> <span class="o">=</span> <span class="n">SimpleOlogClient</span><span class="p">()</span>
<span class="n">generic_logbook_func</span> <span class="o">=</span> <span class="n">simple_olog_client</span><span class="o">.</span><span class="n">log</span>
<span class="n">configured_logbook_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">generic_logbook_func</span><span class="p">,</span> <span class="n">logbooks</span><span class="o">=</span><span class="n">LOGBOOKS</span><span class="p">)</span>

<span class="n">cb</span> <span class="o">=</span> <span class="n">logbook_cb_factory</span><span class="p">(</span><span class="n">configured_logbook_func</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The module <code class="docutils literal notranslate"><span class="pre">bluesky.callbacks.olog</span></code> includes some templates that format the
data from the ‘start’ document into a readable log entry. You can also write
customize templates and pass them to <code class="docutils literal notranslate"><span class="pre">logbook_cb_factory</span></code>.</p>
<p>You may specify a custom template. Here is a very simple example; see the
<a class="reference external" href="https://github.com/NSLS-II/bluesky/blob/master/bluesky/callbacks/olog.py">source code</a>
for a more complex example (the default template).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CUSTOM_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">My Log Entry</span>

<span class="s2">{{ start.plan_name }}</span>
<span class="s2">Detectors: {{ start.detectors }}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Do same boilerplate above to set up configured_logbook_func. Then:</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">logbook_cb_factory</span><span class="p">(</span><span class="n">configured_logbook_func</span><span class="p">,</span>
                        <span class="n">desc_template</span><span class="o">=</span><span class="n">CUSTOM_TEMPLATE</span><span class="p">)</span>
</pre></div>
</div>
<p>You may also specify a variety of different templates that are suitable for
different kinds of plans. The callback will use the <code class="docutils literal notranslate"><span class="pre">'plan_name'</span></code> field to
determine which template to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a template for a &#39;count&#39; plan (which has no motors)</span>
<span class="n">COUNT_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Plan Name: {{ start.plan_name }}</span>
<span class="s2">Detectors: {{ start.detectors }}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># a template for any plan with motors</span>
<span class="n">SCAN_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Plan Name: {{ start.plan_name }}</span>
<span class="s2">Detectors: {{ start.detectors }}</span>
<span class="s2">Motor(s): {{ start.motors }}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">templates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">COUNT_TEMPLATE</span><span class="p">,</span>
             <span class="s1">&#39;scan&#39;</span><span class="p">:</span> <span class="n">SCAN_TEMPLATE</span><span class="p">,</span>
             <span class="s1">&#39;rel_scan&#39;</span><span class="p">:</span> <span class="n">SCAN_TEMPLATE</span><span class="p">}</span>

<span class="c1"># Do same boilerplate above to set up configured_logbook_func. Then:</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">logbook_cb_factory</span><span class="p">(</span><span class="n">configured_logbook_func</span><span class="p">,</span>
                        <span class="n">desc_dispatch</span><span class="o">=</span><span class="n">templates</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="bluesky.callbacks.olog.logbook_cb_factory">
<span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.olog.</span></span><span class="sig-name descname"><span class="pre">logbook_cb_factory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logbook_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">desc_template</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_template</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">desc_dispatch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_dispatch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/olog.html#logbook_cb_factory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.olog.logbook_cb_factory" title="Link to this definition">#</a></dt>
<dd><p>Create a logbook run_start callback</p>
<p>The returned function is suitable for registering as
a ‘start’ callback on the the BlueSky run engine.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>logbook_func</strong><span class="classifier">callable</span></dt><dd><p>The required signature should match the API <code class="docutils literal notranslate"><span class="pre">SimpleOlogClient.log</span></code>.
It is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logbook_func</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logbooks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">ensure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>desc_template</strong><span class="classifier">str, optional</span></dt><dd><p>A jinja2 template to be used for the description line in olog.  This is
the default used if the plan_name does not map to a more specific one.</p>
</dd>
<dt><strong>long_template</strong><span class="classifier">str, optional</span></dt><dd><p>A jinja2 template to be used for the attachment in olog.  This is
the default used if the plan_name does not map to a more specific one.</p>
</dd>
<dt><strong>desc_dispatch, long_dispatch</strong><span class="classifier">mapping, optional</span></dt><dd><p>Mappings between ‘plan_name’ to jinja2 templates to use for the
description and attachments respectively.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="verify-data-has-been-saved">
<h2>Verify Data Has Been Saved<a class="headerlink" href="#verify-data-has-been-saved" title="Link to this heading">#</a></h2>
<p>The following verifies that all Documents and external files from a run have
been saved to disk and are accessible from the DataBroker.  It prints a message
indicating success or failure.</p>
<p>Note: If the data collection machine is not able to access the machine where
some external data is being saved, it will indicate failure. This can be a
false alarm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.broker</span> <span class="kn">import</span> <span class="n">post_run</span><span class="p">,</span> <span class="n">verify_files_saved</span>

<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">post_run</span><span class="p">(</span><span class="n">verify_files_saved</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="ignoring-callback-exceptions">
<span id="debugging-callbacks"></span><h2>Ignoring Callback Exceptions<a class="headerlink" href="#ignoring-callback-exceptions" title="Link to this heading">#</a></h2>
<p>If an exception is raised while processing a callback, the error can interrupt
data collection. Sometimes, this is good: if, for example, the callback that is
saving your data encounters an error, you want to know immediately rather than
continuing to <em>think</em> you are collecting data when in fact it is being lost.
But in many situations, such as visualization or first-pass data processing, it
is usually better for data collection to proceed even if a callback fails.
These decorators may be used to wrap callbacks so that any errors they
encounter are converted to log messages.</p>
<dl class="py function">
<dt class="sig sig-object py" id="bluesky.callbacks.core.make_callback_safe">
<span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.core.</span></span><span class="sig-name descname"><span class="pre">make_callback_safe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/core.html#make_callback_safe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.core.make_callback_safe" title="Link to this definition">#</a></dt>
<dd><p>If the wrapped func raises any exceptions, log them but continue.</p>
<p>This is intended to ensure that any failures in non-critical callbacks do
not interrupt data acquisition. It should <em>not</em> be applied to any
critical callbacks, such as ones that perform data-saving, but is well
suited to callbacks that perform non-critical streaming visualization or
data processing.</p>
<p>To debug the issue causing a failure, it can be convenient to turn this
off and let the failures raise. To do this, set the environment variable
<code class="docutils literal notranslate"><span class="pre">BLUESKY_DEBUG_CALLBACKS=1</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>func: callable</strong></dt><dd></dd>
<dt><strong>logger: logging.Logger, optional</strong></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Decorate a callback to make sure it will not interrupt data acquisition if
it fails.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@make_callback_safe</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="gp">... </span>    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bluesky.callbacks.core.make_class_safe">
<span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.core.</span></span><span class="sig-name descname"><span class="pre">make_class_safe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_wrap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/core.html#make_class_safe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.core.make_class_safe" title="Link to this definition">#</a></dt>
<dd><p>If the wrapped func raises any exceptions, log them but continue.</p>
<p>This is intended to ensure that any failures in non-critical callbacks do
not interrupt data acquisition. It should <em>not</em> be applied to any
critical callbacks, such as ones that perform data-saving, but is well
suited to callbacks that perform non-critical streaming visualization or
data processing.</p>
<p>To debug the issue causing a failure, it can be convenient to turn this
off and let the failures raise. To do this, set the environment variable
<code class="docutils literal notranslate"><span class="pre">BLUESKY_DEBUG_CALLBACKS=1</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cls: callable</strong></dt><dd></dd>
<dt><strong>to_wrap: List[String], optional</strong></dt><dd><p>Names of methods of cls to wrap. Default is <code class="docutils literal notranslate"><span class="pre">['__call__']</span></code>.</p>
</dd>
<dt><strong>logger: logging.Logger, optional</strong></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Decorate a class to make sure it will not interrupt data acquisition if
it fails.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@make_class_safe</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Callback</span><span class="p">(</span><span class="n">event_model</span><span class="o">.</span><span class="n">DocumentRouter</span><span class="p">):</span>
<span class="gp">... </span>    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<p>It is also possible to configure the RunEngine to ignore <em>all</em> callback
exceptions globally, but this feature is not recommended.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">ignore_callback_exceptions</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.4: </span>In bluesky version 0.6.4 (September 2016) the default value was changed from
<code class="docutils literal notranslate"><span class="pre">True</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
</section>
<section id="filtering-by-document-type">
<span id="filtering"></span><h2>Filtering by Document Type<a class="headerlink" href="#filtering-by-document-type" title="Link to this heading">#</a></h2>
<p>There are four “subscriptions” that a callback to receive documents from:</p>
<ul class="simple">
<li><p>‘start’</p></li>
<li><p>‘stop’</p></li>
<li><p>‘event’</p></li>
<li><p>‘descriptor’</p></li>
</ul>
<p>Additionally, there is an ‘all’ subscription.</p>
<p>The command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
<p>is a shorthand that is normalized to <code class="docutils literal notranslate"><span class="pre">{'all':</span> <span class="pre">[cb]}</span></code>. To receive only certain
documents, specify the document routing explicitly. Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cb</span><span class="p">]}</span>
<span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cb1</span><span class="p">,</span> <span class="n">cb2</span><span class="p">],</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cb3</span><span class="p">]})</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">subs_decorator</span></code>, presented above, accepts the same variety of inputs.</p>
</section>
<section id="writing-custom-callbacks">
<h2>Writing Custom Callbacks<a class="headerlink" href="#writing-custom-callbacks" title="Link to this heading">#</a></h2>
<p>Any function that accepts a Python dictionary as its argument can be used as
a callback. Refer to simple examples above to get started.</p>
<section id="two-simple-custom-callbacks">
<h3>Two Simple Custom Callbacks<a class="headerlink" href="#two-simple-custom-callbacks" title="Link to this heading">#</a></h3>
<p>These simple examples illustrate the concept and the usage.</p>
<p>First, we define a function that takes two arguments</p>
<ol class="arabic simple">
<li><p>the name of the Document type (‘start’, ‘stop’, ‘event’, or ‘descriptor’)</p></li>
<li><p>the Document itself, a dictionary</p></li>
</ol>
<p>This is the <em>callback</em>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="k">def</span> <span class="nf">print_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measured: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>Then, we tell the RunEngine to call this function on each Event Document.
We are setting up a <em>subscription</em>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span>

<span class="gp">In [12]: </span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>

<span class="gp">In [13]: </span><span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">]),</span> <span class="p">{</span><span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">print_data</span><span class="p">})</span>


<span class="go">Transient Scan ID: 3     Time: 2024-10-29 14:03:43</span>
<span class="go">Persistent Unique Scan ID: &#39;ff545400-43c9-42e2-9e2a-b93be290c3a0&#39;</span>
<span class="go">New stream: &#39;primary&#39;</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">|   seq_num |       time |        det |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">|         1 | 14:03:43.5 |      0.000 |</span>
<span class="go">Measured: {&#39;det&#39;: np.float64(3.726653172078671e-06)}</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">generator count [&#39;ff545400&#39;] (scan num: 3)</span>



<span class="gh">Out[13]: </span><span class="go">(&#39;ff545400-43c9-42e2-9e2a-b93be290c3a0&#39;,)</span>
</pre></div>
</div>
<p>Each time the RunEngine generates a new Event Document (i.e., data point)
<code class="docutils literal notranslate"><span class="pre">print_data</span></code> is called.</p>
<p>There are five kinds of subscriptions matching the four kinds of Documents plus
an ‘all’ subscription that receives all Documents.</p>
<ul class="simple">
<li><p>‘start’</p></li>
<li><p>‘descriptor’</p></li>
<li><p>‘event’</p></li>
<li><p>‘stop’</p></li>
<li><p>‘all’</p></li>
</ul>
<p>We can use the ‘stop’ subscription to trigger automatic end-of-run activities.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">celebrate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="c1"># Do nothing with the input; just use it as a signal that run is over.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The run is finished!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s use both <code class="docutils literal notranslate"><span class="pre">print_data</span></code> and <code class="docutils literal notranslate"><span class="pre">celebrate</span></code> at once.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">print_data</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="n">celebrate</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="using-multiple-document-types">
<h3>Using multiple document types<a class="headerlink" href="#using-multiple-document-types" title="Link to this heading">#</a></h3>
<p>Some tasks use only one Document type, but we often need to use more than one.
For example, LiveTable uses ‘start’ kick off the creation of a fresh table,
it uses ‘event’ to see the data, and it uses ‘stop’ to draw the bottom border.</p>
<p>A convenient pattern for this kind of subscription is a class with a method
for each Document type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">CallbackBase</span>

<span class="k">class</span> <span class="nc">MyCallback</span><span class="p">(</span><span class="n">CallbackBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I got a new &#39;start&#39; Document&quot;</span><span class="p">)</span>
        <span class="c1"># Do something</span>
    <span class="k">def</span> <span class="nf">descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I got a new &#39;descriptor&#39; Document&quot;</span><span class="p">)</span>
        <span class="c1"># Do something</span>
    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I got a new &#39;event&#39; Document&quot;</span><span class="p">)</span>
        <span class="c1"># Do something</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I got a new &#39;stop&#39; Document&quot;</span><span class="p">)</span>
        <span class="c1"># Do something</span>
</pre></div>
</div>
<p>The base class, <code class="docutils literal notranslate"><span class="pre">CallbackBase</span></code>, takes care of dispatching each Document to
the corresponding method. If your application does not need all four, you may
simple omit methods that aren’t required.</p>
</section>
</section>
<section id="subscriptions-in-separate-processes-or-host-with-0mq">
<span id="zmq-callback"></span><h2>Subscriptions in Separate Processes or Host with 0MQ<a class="headerlink" href="#subscriptions-in-separate-processes-or-host-with-0mq" title="Link to this heading">#</a></h2>
<p>Because subscriptions are processed during a scan, it’s possible that they can
slow down data collection. We mitigate this by making the subscriptions run in
a separate process.</p>
<p>In the main process, where the RunEngine is executing the plan, a <code class="docutils literal notranslate"><span class="pre">Publisher</span></code>
is created. It subscribes to the RunEngine. It serializes the documents it
receives and it sends them over a socket to a 0MQ proxy which rebroadcasts the
documents to any number of other processes or machines on the network.</p>
<p>These other processes or machines set up a <code class="docutils literal notranslate"><span class="pre">RemoteDispatcher</span></code> which connects
to the proxy receives the documents, and then runs callbacks just as they would
be run if they were in the local <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code> process.</p>
<p>Multiple Publishers (each with its own RunEngine) can send documents to the
same proxy. RemoteDispatchers can filter the document stream based a byte
prefix.</p>
<section id="minimal-example">
<h3>Minimal Example<a class="headerlink" href="#minimal-example" title="Link to this heading">#</a></h3>
<p>Start a 0MQ proxy using the CLI packaged with bluesky. It requires two ports as
arguments.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bluesky-0MQ-proxy<span class="w"> </span><span class="m">5577</span><span class="w"> </span><span class="m">5578</span>
</pre></div>
</div>
<p>Alternatively, you can start the proxy using a Python API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.zmq</span> <span class="kn">import</span> <span class="n">Proxy</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="mi">5577</span><span class="p">,</span> <span class="mi">5578</span><span class="p">)</span>
<span class="n">proxy</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Start a callback that will receive documents from the proxy and, in this
simple example, just print them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks.zmq</span> <span class="kn">import</span> <span class="n">RemoteDispatcher</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">RemoteDispatcher</span><span class="p">(</span><span class="s1">&#39;localhost:5578&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>

<span class="c1"># when done subscribing things and ready to use:</span>
<span class="n">d</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># runs event loop forever</span>
</pre></div>
</div>
<p>Qt5 equivelant example where generated documents printed as string in a QLabel as well
as the console.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python3</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>

<span class="k">class</span> <span class="nc">tst_window</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">tst_window</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;TEST&#39;</span><span class="p">)</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">dud</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">args</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test&quot;&quot;&quot;</span>
    <span class="c1"># -- Create QApplication</span>
    <span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
    <span class="kn">from</span> <span class="nn">bluesky.callbacks.zmq</span> <span class="kn">import</span> <span class="n">RemoteDispatcher</span>
    <span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">install_remote_qt_kicker</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">([])</span>

    <span class="n">win</span> <span class="o">=</span> <span class="n">tst_window</span><span class="p">()</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">RemoteDispatcher</span><span class="p">(</span><span class="s1">&#39;localhost:5578&#39;</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">print_callback</span><span class="p">)</span>
    <span class="n">install_remote_qt_kicker</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># starts the event loop for asnycio as well as it will call processEvents() for Qt</span>
    <span class="n">d</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>As <a class="reference external" href="kickers">described above</a>, if you want to use any live-updating plots,
you will need to install a “kicker”. It needs to be installed on the same
event loop used by the RemoteDispatcher, like so, and it must be done before
calling <code class="docutils literal notranslate"><span class="pre">d.start()</span></code>.</p>
<p>In the most recent versions of BlueSky the kickers were deprecated because the
RunEngine now contains a <cite>during_task</cite> parameter that defaults to
<a class="reference external" href="https://nsls-ii.github.io/bluesky/generated/bluesky.utils.DefaultDuringTask.html?highlight=defaultduringtask#bluesky-utils-defaultduringtask">DefaultDuringTask</a>
which takes care of calling the Qt event loop so that Qt applications will process
properly. The issue is that not all Qt applications are themselves the creators of
a RunEngine instance, as in the case of RemoteDispatcher. When using RemoteDispatcher
in a Qt application you need to call <cite>install_remote_qt_kicker</cite> and</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">install_remote_qt_kicker</span>
<span class="n">install_remote_qt_kicker</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
</pre></div>
</div>
<p>In a Jupyter notebook, replace <code class="docutils literal notranslate"><span class="pre">install_remote_qt_kicker</span></code> with
<code class="docutils literal notranslate"><span class="pre">install_nb_kicker</span></code>.</p>
<p>On the machine/process where you want to collect data, hook up a subscription
to publish documents to the proxy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a RunEngine instance (or, of course, use your existing one).</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span><span class="p">,</span> <span class="n">Msg</span>
<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>

<span class="kn">from</span> <span class="nn">bluesky.callbacks.zmq</span> <span class="kn">import</span> <span class="n">Publisher</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;localhost:5577&#39;</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, execute a plan with the RunEngine. As a result, the callback in the
RemoteDispatcher should print the documents generated by this plan.</p>
</section>
<section id="publisher-remotedispatcher-api">
<h3>Publisher / RemoteDispatcher API<a class="headerlink" href="#publisher-remotedispatcher-api" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.zmq.Proxy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.zmq.</span></span><span class="sig-name descname"><span class="pre">Proxy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/zmq.html#Proxy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.zmq.Proxy" title="Link to this definition">#</a></dt>
<dd><p>Start a 0MQ proxy on the local host.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>in_port</strong><span class="classifier">int, optional</span></dt><dd><p>Port that RunEngines should broadcast to. If None, a random port is
used.</p>
</dd>
<dt><strong>out_port</strong><span class="classifier">int, optional</span></dt><dd><p>Port that subscribers should subscribe to. If None, a random port is
used.</p>
</dd>
<dt><strong>zmq</strong><span class="classifier">object, optional</span></dt><dd><p>By default, the ‘zmq’ module is imported and used. Anything else
mocking its interface is accepted.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>in_port</strong><span class="classifier">int</span></dt><dd><p>Port that RunEngines should broadcast to.</p>
</dd>
<dt><strong>out_port</strong><span class="classifier">int</span></dt><dd><p>Port that subscribers should subscribe to.</p>
</dd>
<dt><strong>closed</strong><span class="classifier">boolean</span></dt><dd><p>True if the Proxy has already been started and subsequently
interrupted and is therefore unusable.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run on specific ports.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="mi">5567</span><span class="p">,</span> <span class="mi">5568</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span>
<span class="go">Proxy(in_port=5567, out_port=5568)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># runs until interrupted</span>
</pre></div>
</div>
<p>Run on random ports, and access those ports before starting.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span>
<span class="go">Proxy(in_port=56504, out_port=56505)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">in_port</span>
<span class="go">56504</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">out_port</span>
<span class="go">56505</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># runs until interrupted</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.zmq.Publisher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.zmq.</span></span><span class="sig-name descname"><span class="pre">Publisher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix=b''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RE=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmq=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">serializer=&lt;built-in</span> <span class="pre">function</span> <span class="pre">dumps&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/zmq.html#Publisher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.zmq.Publisher" title="Link to this definition">#</a></dt>
<dd><p>A callback that publishes documents to a 0MQ proxy.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>address</strong><span class="classifier">string or tuple</span></dt><dd><p>Address of a running 0MQ proxy, given either as a string like
<code class="docutils literal notranslate"><span class="pre">'127.0.0.1:5567'</span></code> or as a tuple like <code class="docutils literal notranslate"><span class="pre">('127.0.0.1',</span> <span class="pre">5567)</span></code></p>
</dd>
<dt><strong>prefix</strong><span class="classifier">bytes, optional</span></dt><dd><p>User-defined bytestring used to distinguish between multiple
Publishers. May not contain b’ ‘.</p>
</dd>
<dt><strong>RE</strong><span class="classifier"><code class="docutils literal notranslate"><span class="pre">bluesky.RunEngine</span></code>, optional</span></dt><dd><p>DEPRECATED.
RunEngine to which the Publisher will be automatically subscribed
(and, more importantly, unsubscribed when it is closed).</p>
</dd>
<dt><strong>zmq</strong><span class="classifier">object, optional</span></dt><dd><p>By default, the ‘zmq’ module is imported and used. Anything else
mocking its interface is accepted.</p>
</dd>
<dt><strong>serializer: function, optional</strong></dt><dd><p>optional function to serialize data. Default is pickle.dumps</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Publish from a RunEngine to a Proxy running on localhost on port 5567.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;localhost:5567&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.zmq.RemoteDispatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.zmq.</span></span><span class="sig-name descname"><span class="pre">RemoteDispatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix=b''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmq=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmq_asyncio=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deserializer=&lt;built-in</span> <span class="pre">function</span> <span class="pre">loads&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/zmq.html#RemoteDispatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.zmq.RemoteDispatcher" title="Link to this definition">#</a></dt>
<dd><p>Dispatch documents received over the network from a 0MQ proxy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>address</strong><span class="classifier">tuple</span></dt><dd><p>Address of a running 0MQ proxy, given either as a string like
<code class="docutils literal notranslate"><span class="pre">'127.0.0.1:5567'</span></code> or as a tuple like <code class="docutils literal notranslate"><span class="pre">('127.0.0.1',</span> <span class="pre">5567)</span></code></p>
</dd>
<dt><strong>prefix</strong><span class="classifier">bytes, optional</span></dt><dd><p>User-defined bytestring used to distinguish between multiple
Publishers. If set, messages without this prefix will be ignored.
If unset, no mesages will be ignored.</p>
</dd>
<dt><strong>loop</strong><span class="classifier">zmq.asyncio.ZMQEventLoop, optional</span></dt><dd></dd>
<dt><strong>zmq</strong><span class="classifier">object, optional</span></dt><dd><p>By default, the ‘zmq’ module is imported and used. Anything else
mocking its interface is accepted.</p>
</dd>
<dt><strong>zmq_asyncio</strong><span class="classifier">object, optional</span></dt><dd><p>By default, the ‘zmq.asyncio’ module is imported and used. Anything
else mocking its interface is accepted.</p>
</dd>
<dt><strong>deserializer: function, optional</strong></dt><dd><p>optional function to deserialize data. Default is pickle.loads</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Print all documents generated by remote RunEngines.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">RemoteDispatcher</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5568</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># runs until interrupted</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="secondary-event-stream">
<h2>Secondary Event Stream<a class="headerlink" href="#secondary-event-stream" title="Link to this heading">#</a></h2>
<p>For certain applications, it may desirable to interpret event documents as
they are created instead of waiting for them to reach offline storage. In order
to keep this information completely quarantined from the raw data, the
<a class="reference internal" href="#bluesky.callbacks.stream.LiveDispatcher" title="bluesky.callbacks.stream.LiveDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">LiveDispatcher</span></code></a> presents a completely unique stream that can be
subscribed to using the same syntax as the RunEngine.</p>
<p>In the majority of applications of <a class="reference internal" href="#bluesky.callbacks.stream.LiveDispatcher" title="bluesky.callbacks.stream.LiveDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">LiveDispatcher</span></code></a>, it is expected
that subclasses are created to implement online analysis. This secondary event
stream can be displayed and saved offline using the same callbacks that you
would use to display the raw data.</p>
<p>Below is an example using the <a class="reference external" href="https://streamz.readthedocs.io/en/latest">streamz</a> library to average a number of
events together. The callback can be configured by looking at the start
document metadata, or at initialization time. Events are then received and
stored by the <code class="docutils literal notranslate"><span class="pre">streamz</span></code> network and a new averaged event is emitted when the
correct number of events are in the cache. The important thing to note here is
that the analysis only handles creating new <code class="docutils literal notranslate"><span class="pre">data</span></code> keys, but the descriptors,
sequence numbering and event ids are all handled by the base <cite>LiveDispatcher</cite>
class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AverageStream</span><span class="p">(</span><span class="n">LiveDispatcher</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream that averages data points together&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the stream after seeing the start document</span>

<span class="sd">        The callback looks for the &#39;average&#39; key in the start document to</span>
<span class="sd">        configure itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Grab the average key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="c1"># Define our nodes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span> <span class="o">=</span> <span class="n">streamz</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">stream_name</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">averager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">average_events</span><span class="p">(</span><span class="n">cache</span><span class="p">):</span>
            <span class="n">average_evt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">desc_id</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;descriptor&#39;</span><span class="p">]</span>
            <span class="c1"># Check that all of our events came from the same configuration</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">desc_id</span> <span class="o">==</span> <span class="n">evt</span><span class="p">[</span><span class="s1">&#39;descriptor&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">evt</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The events in this bundle are from &#39;</span>
                                <span class="s1">&#39;different configurations!&#39;</span><span class="p">)</span>
            <span class="c1"># Use the last descriptor to avoid strings and objects</span>
            <span class="n">data_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_descriptors</span><span class="p">[</span><span class="n">desc_id</span><span class="p">][</span><span class="s1">&#39;data_keys&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Information from non-number fields is dropped</span>
                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">):</span>
                    <span class="c1"># Average together</span>
                    <span class="n">average_evt</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">evt</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
                                                <span class="k">for</span> <span class="n">evt</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">average_evt</span><span class="p">,</span> <span class="s1">&#39;descriptor&#39;</span><span class="p">:</span> <span class="n">desc_id</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">averager</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">average_events</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_node</span><span class="o">.</span><span class="n">sink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_event</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send an Event through the stream&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the stream when run stops&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<section id="livedispatcher-api">
<h3>LiveDispatcher API<a class="headerlink" href="#livedispatcher-api" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky.callbacks.stream.</span></span><span class="sig-name descname"><span class="pre">LiveDispatcher</span></span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher" title="Link to this definition">#</a></dt>
<dd><p>A secondary event stream of processed data</p>
<p>The LiveDipatcher base implementation does not change any of the data
emitted, this task is left to sub-classes, but instead handles
reimplementing a secondary event stream that fits the same schema demanded
by the RunEngine itself. In order to reduce the work done by these
processed data pipelines, the LiveDispatcher handles the nitty-gritty
details of formatting the event documents. This includes creating new uids,
numbering events and creating descriptors.</p>
<p>The LiveDispatcher can be subscribed to using the same syntax as the
RunEngine, effectively creating a small chain of callbacks</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create our dispatcher</span>
<span class="n">ld</span> <span class="o">=</span> <span class="n">LiveDispatcher</span><span class="p">()</span>
<span class="c1"># Subscribe it to receive events from the RunEgine</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span>
<span class="c1"># Subscribe any callbacks we desire to second stream</span>
<span class="n">ld</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;motor&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.descriptor">
<span class="sig-name descname"><span class="pre">descriptor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.descriptor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.descriptor" title="Link to this definition">#</a></dt>
<dd><p>Store a descriptor</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.emit">
<span class="sig-name descname"><span class="pre">emit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.emit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.emit" title="Link to this definition">#</a></dt>
<dd><p>Check the document schema and send to the dispatcher</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.event">
<span class="sig-name descname"><span class="pre">event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.event" title="Link to this definition">#</a></dt>
<dd><p>Receive an event document from the raw stream.</p>
<p>This should be reimplemented by a subclass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>doc</strong><span class="classifier">event</span></dt><dd></dd>
<dt><strong>kwargs:</strong></dt><dd><p>All keyword arguments are passed to <a class="reference internal" href="#bluesky.callbacks.stream.LiveDispatcher.process_event" title="bluesky.callbacks.stream.LiveDispatcher.process_event"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_event()</span></code></a></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.process_event">
<span class="sig-name descname"><span class="pre">process_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'primary'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.process_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.process_event" title="Link to this definition">#</a></dt>
<dd><p>Process a modified event document then emit it for the modified stream</p>
<p>This will pass an Event document to the dispatcher. If we have received
a new event descriptor from the original stream, or we have received a
new set of <cite>id_args</cite> or <cite>descriptor_id</cite> , a new descriptor document is
first issued and passed through to the dispatcher.  When issuing a new
event, the new descriptor is given a new source field.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>doc</strong><span class="classifier">event</span></dt><dd></dd>
<dt><strong>stream_name</strong><span class="classifier">str, optional</span></dt><dd><p>String identifier for a particular stream</p>
</dd>
<dt><strong>id_args</strong><span class="classifier">tuple, optional</span></dt><dd><p>Additional tuple of hashable objects to identify the stream</p>
</dd>
<dt><strong>config: dict, optional</strong></dt><dd><p>Additional configuration information to be included in the event
descriptor</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Any callback subscribed to the <cite>Dispatcher</cite> will receive these event
streams.  If nothing is subscribed, these documents will not go
anywhere.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_md</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.start" title="Link to this definition">#</a></dt>
<dd><p>Receive a raw start document, re-emit it for the modified stream</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_md</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.stop" title="Link to this definition">#</a></dt>
<dd><p>Receive a raw stop document, re-emit it for the modified stream</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.subscribe">
<span class="sig-name descname"><span class="pre">subscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.subscribe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.subscribe" title="Link to this definition">#</a></dt>
<dd><p>Convenience function for dispatcher subscription</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluesky.callbacks.stream.LiveDispatcher.unsubscribe">
<span class="sig-name descname"><span class="pre">unsubscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/callbacks/stream.html#LiveDispatcher.unsubscribe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky.callbacks.stream.LiveDispatcher.unsubscribe" title="Link to this definition">#</a></dt>
<dd><p>Convenience function for dispatcher un-subscription</p>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="metadata.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Recording Metadata</p>
      </div>
    </a>
    <a class="right-next"
       href="generated/bluesky.callbacks.best_effort.BestEffortCallback.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">bluesky.callbacks.best_effort.BestEffortCallback</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-callbacks">Overview of Callbacks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simplest-working-example">Simplest Working Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ways-to-invoke-callbacks">Ways to Invoke Callbacks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interactively">Interactively</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#persistently">Persistently</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#through-a-plan">Through a plan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#callbacks-for-visualization-fitting">Callbacks for Visualization &amp; Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livetable">LiveTable</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.LiveTable"><code class="docutils literal notranslate"><span class="pre">LiveTable</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aside-making-plots-update-live">Aside: Making plots update live</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.utils.install_kicker"><code class="docutils literal notranslate"><span class="pre">install_kicker()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.utils.install_qt_kicker"><code class="docutils literal notranslate"><span class="pre">install_qt_kicker()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.utils.install_nb_kicker"><code class="docutils literal notranslate"><span class="pre">install_nb_kicker()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#liveplot-for-scalar-data">LivePlot (for scalar data)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.mpl_plotting.LivePlot"><code class="docutils literal notranslate"><span class="pre">LivePlot</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#live-image">Live Image</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.broker.LiveImage"><code class="docutils literal notranslate"><span class="pre">LiveImage</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livegrid-gridded-heat-map">LiveGrid (gridded heat map)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.mpl_plotting.LiveGrid"><code class="docutils literal notranslate"><span class="pre">LiveGrid</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livescatter-scattered-heat-map">LiveScatter (scattered heat map)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.mpl_plotting.LiveScatter"><code class="docutils literal notranslate"><span class="pre">LiveScatter</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livefit">LiveFit</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.LiveFit"><code class="docutils literal notranslate"><span class="pre">LiveFit</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livefitplot">LiveFitPlot</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.mpl_plotting.LiveFitPlot"><code class="docutils literal notranslate"><span class="pre">LiveFitPlot</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peakstats">PeakStats</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.fitting.PeakStats"><code class="docutils literal notranslate"><span class="pre">PeakStats</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.mpl_plotting.plot_peak_stats"><code class="docutils literal notranslate"><span class="pre">plot_peak_stats()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-effort-callback">Best-Effort Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-stats">Peak Stats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hints">Hints</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#callback-for-export">Callback for Export</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exporting-image-data-as-tiff-files">Exporting Image Data as TIFF Files</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.broker.LiveTiffExporter"><code class="docutils literal notranslate"><span class="pre">LiveTiffExporter</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-all-data-and-metadata-in-an-hdf5-file">Export All Data and Metadata in an HDF5 File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-metadata-to-the-olog">Export Metadata to the Olog</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.olog.logbook_cb_factory"><code class="docutils literal notranslate"><span class="pre">logbook_cb_factory()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verify-data-has-been-saved">Verify Data Has Been Saved</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ignoring-callback-exceptions">Ignoring Callback Exceptions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.core.make_callback_safe"><code class="docutils literal notranslate"><span class="pre">make_callback_safe()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.core.make_class_safe"><code class="docutils literal notranslate"><span class="pre">make_class_safe()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-by-document-type">Filtering by Document Type</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-custom-callbacks">Writing Custom Callbacks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-simple-custom-callbacks">Two Simple Custom Callbacks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiple-document-types">Using multiple document types</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subscriptions-in-separate-processes-or-host-with-0mq">Subscriptions in Separate Processes or Host with 0MQ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minimal-example">Minimal Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#publisher-remotedispatcher-api">Publisher / RemoteDispatcher API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.zmq.Proxy"><code class="docutils literal notranslate"><span class="pre">Proxy</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.zmq.Publisher"><code class="docutils literal notranslate"><span class="pre">Publisher</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.zmq.RemoteDispatcher"><code class="docutils literal notranslate"><span class="pre">RemoteDispatcher</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#secondary-event-stream">Secondary Event Stream</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#livedispatcher-api">LiveDispatcher API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.descriptor"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.descriptor()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.emit"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.emit()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.event"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.event()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.process_event"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.process_event()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.start"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.start()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.stop"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.stop()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.subscribe"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.subscribe()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky.callbacks.stream.LiveDispatcher.unsubscribe"><code class="docutils literal notranslate"><span class="pre">LiveDispatcher.unsubscribe()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/bluesky/bluesky/edit/1.14.dev25+gaa6d13ed/docs/callbacks.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/callbacks.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2015, Brookhaven National Lab.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>