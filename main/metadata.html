
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Recording Metadata &#8212; bluesky 1.14.dev46+g8ad45bf5 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9df64881"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'metadata';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://blueskyproject.io/bluesky/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.14.dev46+g8ad45bf5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Live Visualization and Processing" href="callbacks.html" />
    <link rel="prev" title="Documents" href="documents.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.14.dev46+g8ad45bf5" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/bluesky-logo-dark.svg" class="logo__image only-light" alt=""/>
    <img src="_static/bluesky-logo-dark.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">bluesky</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="userindex.html">
    User Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="devindex.html">
    Developer Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/bluesky">
    bluesky
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/ophyd">
    ophyd
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/databroker">
    databroker
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://nsls-ii.github.io/amostra">
    amostra
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://nsls-ii.github.io/datamuxer">
    datamuxer
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://blueskyproject.io/suitcase">
    suitcase
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/NSLS-II/">
    NSLS-II Repositories
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/NSLS-II/Bug-Reports/issues">
    Bug Reports
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/bluesky/bluesky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/bluesky" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="userindex.html">
    User Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="devindex.html">
    Developer Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/bluesky">
    bluesky
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/ophyd">
    ophyd
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/databroker">
    databroker
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://nsls-ii.github.io/amostra">
    amostra
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://nsls-ii.github.io/datamuxer">
    datamuxer
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://blueskyproject.io/suitcase">
    suitcase
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NSLS-II/">
    NSLS-II Repositories
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NSLS-II/Bug-Reports/issues">
    Bug Reports
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/bluesky/bluesky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/bluesky" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="plans.html">Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Recording Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks.html">Live Visualization and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="state-machine.html">Interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation and Error Checking</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress-bar.html">Progress Bar</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_descriptors.html">Event Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">Asynchronous Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_run_plans.html">Multi-Run Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging and Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine_api.html">RunEngine API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="magics.html">IPython ‘Magics’ [Experimental]</a></li>
<li class="toctree-l1"><a class="reference internal" href="otel-tracing.html">Tracing with Opentelemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="from-pyepics-to-bluesky.html">Translating Direct PyEpics Code to Bluesky Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison-with-spec.html">Comparison with SPEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware-interfaces.html">Hardware Interface Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="userindex.html" class="nav-link">User Documentation</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Recording Metadata</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="recording-metadata">
<h1>Recording Metadata<a class="headerlink" href="#recording-metadata" title="Link to this heading">#</a></h1>
<p>Capturing useful metadata is the main objective of bluesky. The more
information you can provide about what you are doing and why you are
doing it, the more useful bluesky and downstream data search and
analysis tools can be.</p>
<p>The term “metadata” can be a controversial term, one scientist’s
“data” is another’s “metadata” and classification is context- dependent.
The same exact information can be “data” in one
experiment, but “metadata” in a different experiment done on the exact
same hardware.
The <a class="reference external" href="https://blueskyproject.io/event-model/data-model.html">Document Model</a> provides a framework
for deciding _where_ to record a particular piece of information.</p>
<p>There are some things that we know <em>a priori</em> before doing an experiment;
where are we? who is the user? what sample are we looking at? what did
the user just ask us to do?  These are all things that we can, in
principle, know independent of the control system.  These are the
prime candidates for inclusion in the <a class="reference external" href="https://blueskyproject.io/event-model/data-model.html#run-start-document">Start Document</a>.
Downstream DataBroker provides tools to do rich searches on this data.
The more information you can include the better.</p>
<p>There is some information that we need that is nominally independent of
any particular device but we need to consult the controls system
about.  For example the location of important, but un-scanned motors
or the configuration of beam attenuators.  If the values <em>should</em> be fixed over
the course of the experiment then this it is a good candidate for
being a “baseline device” either via the <a class="reference external" href="https://blueskyproject.io/bluesky/tutorial.html#baseline-readings-and-other-supplemental-data">Supplemental pre-processor</a>
or explicitly in custom plans.  This will put the readings in a separate stream
(which is a peer to the “primary” data).  In principle, these values <em>could</em> be
read from the control system once and put into the Start document along with
the <em>a priori</em> information, however that has several draw backs:</p>
<ol class="arabic simple">
<li><p>There is only ever 1 reading of the values so if they do drift during
data acquisition, you will never know.</p></li>
<li><p>We cannot automatically capture information about the device like
we do for data in Events.  This includes things like the datatype,
units, and shape of the value and any configuration information about the
hardware it is being read from.</p></li>
</ol>
<p>A third class of information that can be called “metadata” is
configuration information of pieces of hardware.  These are things
like the velocity of a motor or the integration time of a detector.
These readings are embedded in the <a class="reference external" href="https://blueskyproject.io/event-model/data-model.html#event-descriptor">Descriptor</a>
and are extracted from the hardware via the <a class="reference external" href="https://blueskyproject.io/bluesky/hardware.html#ReadableDevice.read_configuration">read_configuration</a>
method of the hardware.  We expect that these values will not change over
the course of the experiment so only read them once.</p>
<p>Information that does not fall into one of these categories, because
you expect it to change during the experiment,
should be treated as “data”, either as an explicit part of the
experimental plan or via <a class="reference internal" href="async.html#async-monitoring"><span class="std std-ref">Monitoring</span></a>.</p>
<section id="adding-to-the-start-document">
<h2>Adding to the Start Document<a class="headerlink" href="#adding-to-the-start-document" title="Link to this heading">#</a></h2>
<p>When the RunEngine mints a Start document it includes structured data.  That
information can be injected in via several mechanisms:</p>
<ol class="arabic simple">
<li><p>entered interactively by the user at execution time</p></li>
<li><p>provided in the code of the <em>plan</em></p></li>
<li><p>automatically inferred</p></li>
<li><p>entered by user once and stashed for reuse on all future plans</p></li>
</ol>
<p>If there is a conflict between these sources, the higher entry in this
list wins.  The “closer” to a user the information originated the
higher priority it has.</p>
<section id="interactively-for-one-use">
<h3>1. Interactively, for One Use<a class="headerlink" href="#interactively-for-one-use" title="Link to this heading">#</a></h3>
<p>Suppose we are executing some custom plan called <code class="docutils literal notranslate"><span class="pre">plan</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">())</span>
</pre></div>
</div>
<p>If we give arbitrary extra keyword arguments to <code class="docutils literal notranslate"><span class="pre">RE</span></code>, they will be
interpreted as metadata.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">sample_id</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">purpose</span><span class="o">=</span><span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;Dan&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="documents.html#run-overview"><span class="std std-ref">run(s)</span></a> — i.e., datasets — generated by <code class="docutils literal notranslate"><span class="pre">plan()</span></code>
will include the custom metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="s1">&#39;sample_id&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="o">.</span>
<span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;Dan&#39;</span><span class="p">,</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">plan</span></code> generates more that one run, all the runs will get this metadata.
For example, this plan generates three different runs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span><span class="p">,</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="n">det1</span><span class="p">,</span> <span class="n">det2</span><span class="p">,</span> <span class="n">motor</span>  <span class="c1"># simulated detectors, motor</span>

<span class="k">def</span> <span class="nf">plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">])</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">])</span>
</pre></div>
</div>
<p>If executed as above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">sample_id</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">purpose</span><span class="o">=</span><span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;Dan&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>each run will get a copy of the sample_id, purpose and operator metadata.</p>
</section>
<section id="through-a-plan">
<h3>2. Through a plan<a class="headerlink" href="#through-a-plan" title="Link to this heading">#</a></h3>
<p>Revisiting the previous example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">])</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">])</span>
</pre></div>
</div>
<p>we can pass different metadata for each run. Every
<a class="reference internal" href="plans.html#preassembled-plans"><span class="std std-ref">built-in pre-assembled plan</span></a> accepts a parameter
<code class="docutils literal notranslate"><span class="pre">md</span></code>, which you can use to inject metadata that applies only to that plan.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="p">})</span>  <span class="c1"># one</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;good data&#39;</span><span class="p">})</span>  <span class="c1"># two</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;sanity check&#39;</span><span class="p">})</span>  <span class="c1"># three</span>
</pre></div>
</div>
<p>The metadata passed into <code class="docutils literal notranslate"><span class="pre">RE</span></code> is combined with the metadata passed in to each
plan. Thus, calling</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">sample_id</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;Dan&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>generates these three sets of metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># one</span>
<span class="o">...</span>
<span class="s1">&#39;sample_id&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="o">.</span>
<span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;Dan&#39;</span><span class="p">,</span>
<span class="o">...</span>

<span class="c1"># two</span>
<span class="o">...</span>
<span class="s1">&#39;sample_id&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;good data&#39;</span><span class="o">.</span>
<span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;Dan&#39;</span><span class="p">,</span>
<span class="o">...</span>

<span class="c1"># three</span>
<span class="o">...</span>
<span class="s1">&#39;sample_id&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;sanity check&#39;</span><span class="o">.</span>
<span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;Dan&#39;</span><span class="p">,</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If there is a conflict, <code class="docutils literal notranslate"><span class="pre">RE</span></code> keywords takes precedence. So</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">plan</span><span class="p">(),</span> <span class="n">purpose</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would override the individual ‘purpose’ metadata from the plan, marking all
three as purpose=test.</p>
<p>If you define your own plans, it is best practice have them take a keyword only
argument <code class="docutils literal notranslate"><span class="pre">md=None</span></code>.  This allows the hard-coded meta-data to be over-ridden
later:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plan</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">md</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># handle the default case</span>
    <span class="c1"># putting unpacking **md at the end means it &quot;wins&quot;</span>
    <span class="c1"># and if the user calls</span>
    <span class="c1">#    yield from plan(md={&#39;purpose&#39;: bob})</span>
    <span class="c1"># it will over-ride these values</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">md</span><span class="p">})</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;good data&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">md</span><span class="p">})</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;sanity check&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">md</span><span class="p">})</span>
</pre></div>
</div>
<p>This is consistent with all of the <a class="reference internal" href="plans.html#preassembled-plans"><span class="std std-ref">Pre-assembled Plans</span></a>.</p>
<p>For more on injecting metadata via plans, refer to
<a class="reference internal" href="tutorial.html#tutorial-plan-metadata"><span class="std std-ref">this section</span></a> of the tutorial.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the built-in plans provide certain metadata automatically. Custom
plans are not <em>required</em> to provide any of this, but it is a nice pattern
to follow.</p>
<ul class="simple">
<li><p>plan_name — e.g., <code class="docutils literal notranslate"><span class="pre">'scan'</span></code></p></li>
<li><p>detectors — a list of the names of the detectors</p></li>
<li><p>motors — a list of the names of the motors</p></li>
<li><p>plan_args — dict of keyword arguments passed to the plan</p></li>
<li><p>plan_pattern – function used to create the trajectory</p></li>
<li><p>plan_pattern_module — Python module where <code class="docutils literal notranslate"><span class="pre">plan_pattern</span></code> is defined</p></li>
<li><p>plan_pattern_args — dict of keyword arguments passed to
<code class="docutils literal notranslate"><span class="pre">plan_pattern</span></code> to create the trajectory</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">plan_name</span></code> and <code class="docutils literal notranslate"><span class="pre">plan_args</span></code> together should provide sufficient
information to recreate the plan. The <code class="docutils literal notranslate"><span class="pre">detectors</span></code> and <code class="docutils literal notranslate"><span class="pre">motors</span></code> are
convenient keys to search on later.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plan_pattern*</span></code> entries provide lower-level, more explicit
information about the <em>trajectory</em> (“pattern”) generated by the plan,
separate from the specific detectors and motors involved. For complex
trajectories like spirals, this is especially useful. As a simple example,
here is the pattern-related metadata for <a class="reference internal" href="generated/bluesky.plans.scan.html#bluesky.plans.scan" title="bluesky.plans.scan"><code class="xref py py-func docutils literal notranslate"><span class="pre">scan()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="s1">&#39;plan_pattern&#39;</span><span class="p">:</span> <span class="s1">&#39;linspace&#39;</span><span class="p">,</span>
<span class="s1">&#39;plan_pattern_module&#39;</span><span class="p">:</span> <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
<span class="s1">&#39;plan_pattern_args&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Thus, one can re-create the “pattern” (trajectory) like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="automatically">
<h3>3. Automatically<a class="headerlink" href="#automatically" title="Link to this heading">#</a></h3>
<p>For each run, the RunEngine automatically records:</p>
<ul class="simple">
<li><p>‘time’ — In this context, the start time. (Other times are also recorded.)</p></li>
<li><p>‘uid’ — a globally unique ID for this run</p></li>
<li><p>‘plan_name’ — the function or class name of <code class="docutils literal notranslate"><span class="pre">plan</span></code> (e.g., ‘count’)</p></li>
<li><p>‘plan_type’— e.g., the Python type of <code class="docutils literal notranslate"><span class="pre">plan</span></code> (e.g., ‘generator’)</p></li>
</ul>
<p>The last two can be overridden by any of the methods above. The first two
cannot be overridden by the user.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If some custom plan does not specify a ‘plan_name’ and ‘plan_type’, the
RunEngine infers them as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plan_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
<span class="n">plan_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>These may be more or less informative depending on what <code class="docutils literal notranslate"><span class="pre">plan</span></code> is. They
are just heuristics to provide <em>some</em> information by default if the plan
itself and the user do not provide it.</p>
</div>
</section>
<section id="interactively-for-repeated-use">
<h3>4. Interactively, for Repeated Use<a class="headerlink" href="#interactively-for-repeated-use" title="Link to this heading">#</a></h3>
<p>Each time a plan is executed, the current contents of <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> are copied into
the metadata for all runs generated by the plan.  To enter metadata once to
reuse on all plans, add it to <code class="docutils literal notranslate"><span class="pre">RE.md</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;proposal_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123456</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;flying cars&#39;</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>View its current contents,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>delete a key you want to stop using,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span>   <span class="c1"># delete a key</span>
</pre></div>
</div>
<p>or use any of the standard methods that apply to
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typesmapping">dictionaries in Python</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In general we recommend against putting device readings in the Start
document. (The Start document is for who/what/why/when, things you
know before you start communicating with hardware.) It is <em>especially</em>
critical that you do not put device readings in the <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> dictionary.
The value will remain until you change it and not track the state of the
hardware.  This will result in recording out-of-date, incorrect data!</p>
<p>This can be particularly dangerous if <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> is backed by a
persistent data store (see next section) because out-of-date readings will
last across sessions.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">scan_id</span></code>, an integer that the RunEngine automatically increments at the
beginning of each scan, is stored in <code class="docutils literal notranslate"><span class="pre">RE.md['scan_id']</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Clearing all keys, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># clear *all* keys</span>
</pre></div>
</div>
<p>will reset the <code class="docutils literal notranslate"><span class="pre">scan_id</span></code>. The next time a plan is executed, the
RunEngine will start with a <code class="docutils literal notranslate"><span class="pre">scan_id</span></code> of 1 and set</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;scan_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Some readers may prefer to reset the scan ID to 1 at the beginning of a new
experiment; others way wish to maintain a single unbroken sequence of scan
IDs forever.</p>
<p>From a technical standpoint, it is fine to have duplicate scan IDs. All
runs also have randomly-generated ‘uid’ (“unique ID”) which is globally
unique forever.</p>
</div>
</section>
<section id="persistence-between-sessions">
<span id="md-persistence"></span><h3>Persistence Between Sessions<a class="headerlink" href="#persistence-between-sessions" title="Link to this heading">#</a></h3>
<p>We provide a way to save the contents of the metadata stash <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> between
sessions (e.g., exiting and re-opening IPython).</p>
<p>In general, the <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> attribute may be anything that supports the
dictionary interface. The simplest is just a plain Python dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>To persist metadata between sessions, bluesky recommends
<a class="reference internal" href="generated/bluesky.utils.PersistentDict.html#bluesky.utils.PersistentDict" title="bluesky.utils.PersistentDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">bluesky.utils.PersistentDict</span></code></a> — a Python dictionary synced with a
directory of files on disk. Any changes made to <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> are synced to the
file, so the contents of <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> can persist between sessions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">PersistentDict</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="n">PersistentDict</span><span class="p">(</span><span class="s1">&#39;some/path/here&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bluesky does not provide a strong recommendation on that path; that a detail
left to the local deployment.</p>
<p>Bluesky formerly recommended using <code class="xref py py-class docutils literal notranslate"><span class="pre">HistoryDict</span></code> — a
Python dictionary backed by a sqlite database file. This approach proved
problematic with the threading introduced in bluesky v1.6.0, so it is no longer
recommended. If you have been following that recommendation, you should migrate
your metadata from <cite>~historydict.HistoryDict</cite> to
<a class="reference internal" href="generated/bluesky.utils.PersistentDict.html#bluesky.utils.PersistentDict" title="bluesky.utils.PersistentDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PersistentDict</span></code></a>. First, update your configuration to
make <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> a <a class="reference internal" href="generated/bluesky.utils.PersistentDict.html#bluesky.utils.PersistentDict" title="bluesky.utils.PersistentDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PersistentDict</span></code></a> as shown above. Then,
migrate like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">get_history</span>
<span class="n">old_md</span> <span class="o">=</span> <span class="n">get_history</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">old_md</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="generated/bluesky.utils.PersistentDict.html#bluesky.utils.PersistentDict" title="bluesky.utils.PersistentDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PersistentDict</span></code></a> object has been back-ported to
bluesky v1.5.6 as well. It is not available in 1.4.x or older, so once you move
to the new system, you must run bluesky v1.5.6 or higher.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RE.md</span></code> object can also be set when the RunEngine is instantiated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This:</span>
<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># is equivalent to this:</span>
<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>As we stated
<a class="reference internal" href="tutorial.html#tutorial-run-engine-setup"><span class="std std-ref">at the start of the tutorial</span></a>, if you are
using bluesky at a user facility or with shared configuration, your
<code class="docutils literal notranslate"><span class="pre">RE</span></code> may already be configured, and defining a new <code class="docutils literal notranslate"><span class="pre">RE</span></code> as above can
result in data loss! If you aren’t sure, it’s safer to use <code class="docutils literal notranslate"><span class="pre">RE.md</span> <span class="pre">=</span> <span class="pre">...</span></code>.</p>
</div>
</section>
<section id="allowed-data-types">
<h3>Allowed Data Types<a class="headerlink" href="#allowed-data-types" title="Link to this heading">#</a></h3>
<p>Custom metadata keywords can be mapped to:</p>
<ul class="simple">
<li><p>strings — e.g., <code class="docutils literal notranslate"><span class="pre">task='calibration'</span></code></p></li>
<li><p>numbers — e.g., <code class="docutils literal notranslate"><span class="pre">attempt=5</span></code></p></li>
<li><p>lists or tuples — e.g., <code class="docutils literal notranslate"><span class="pre">dimensions=[1,</span> <span class="pre">3]</span></code></p></li>
<li><p>(nested) dictionaries — e.g., <code class="docutils literal notranslate"><span class="pre">dimensions={'width':</span> <span class="pre">1,</span> <span class="pre">'height':</span> <span class="pre">3}</span></code></p></li>
</ul>
</section>
<section id="required-fields">
<h3>Required Fields<a class="headerlink" href="#required-fields" title="Link to this heading">#</a></h3>
<p>The fields:</p>
<ul class="simple">
<li><p><strong>uid</strong></p></li>
<li><p><strong>time</strong></p></li>
</ul>
<p>are reserved by the document model and cannot be set by the user.</p>
<p>In current versions of bluesky, <strong>no fields are universally required by bluesky
itself</strong>. It is possible specify your own required fields in local
configuration. See <a class="reference internal" href="#md-validator"><span class="std std-ref">Validation</span></a>. (At NSLS-II, there are facility-wide
requirements coming soon.)</p>
</section>
<section id="special-fields">
<h3>Special Fields<a class="headerlink" href="#special-fields" title="Link to this heading">#</a></h3>
<p>Arbitrary custom fields are allowed — you can invent any names that are
useful to you.</p>
<p>But certain fields are given special significance by bluesky’s document model,
and are either disallowed are required to be a certain type.</p>
<p>The fields:</p>
<ul class="simple">
<li><p><strong>owner</strong></p></li>
<li><p><strong>group</strong></p></li>
<li><p><strong>project</strong></p></li>
</ul>
<p>are optional but, to facilitate searchability, if they are not blank they must
be strings. A non-string, like <code class="docutils literal notranslate"><span class="pre">owner=5</span></code> will produce an error that will
interrupt scan execution immediately after it starts.</p>
<p>Similarly, the keyword <strong>sample</strong> has special significance. It must be either a
string or a dictionary.</p>
<p>The <strong>scan_id</strong> field is expected to be an integer, and it is automatically
incremented between runs. If a scan_id is not provided by the user or stashed
in the persistent metadata from the previous run, it defaults to 1.</p>
</section>
<section id="validation">
<span id="md-validator"></span><h3>Validation<a class="headerlink" href="#validation" title="Link to this heading">#</a></h3>
<p>Additional, customized metadata validation can be added to the RunEngine.
For example, to ensure that a run will not be executed unless the parameter
‘sample_number’ is specified, define a function that accepts a dictionary
argument and raises if ‘sample_number’ is not found.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ensure_sample_number</span><span class="p">(</span><span class="n">md</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;sample_number&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">md</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You forgot the sample number.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Apply this function by setting</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="o">.</span><span class="n">md_validator</span> <span class="o">=</span> <span class="n">ensure_sample_number</span>
</pre></div>
</div>
<p>The function will be executed immediately before each new run in opened.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="documents.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Documents</p>
      </div>
    </a>
    <a class="right-next"
       href="callbacks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Live Visualization and Processing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-to-the-start-document">Adding to the Start Document</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interactively-for-one-use">1. Interactively, for One Use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#through-a-plan">2. Through a plan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatically">3. Automatically</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interactively-for-repeated-use">4. Interactively, for Repeated Use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#persistence-between-sessions">Persistence Between Sessions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#allowed-data-types">Allowed Data Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#required-fields">Required Fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#special-fields">Special Fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">Validation</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/bluesky/bluesky/edit/1.14.dev46+g8ad45bf5/docs/metadata.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/metadata.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2015, Brookhaven National Lab.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>